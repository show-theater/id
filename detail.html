<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Detail Member - JKT48 Show Theater</title>

<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial,sans-serif;background:#f5f5f5;color:#333;min-height:100vh;padding:0;transition:background 0.3s,color 0.3s}
body.dark{background:#0a0e1a;color:#e5e7eb}

/* Header System */
.main-header{position:fixed;top:0;left:0;right:0;z-index:1001;}

/* Baris 1 - Background merah JKT48 SHOW THEATER */
.header-top-bar{background:#e60012;text-align:center;padding:7px 20px;}
.header-top-title{font-size:13px;font-weight:bold;color:#fff;letter-spacing:0.5px;}

/* Baris 2 - Navigasi */
.detail-header{display:flex;align-items:center;justify-content:space-between;padding:12px 20px;background:#fff;border-bottom:1px solid #ddd;transition:background 0.3s,border-color 0.3s}
body.dark .detail-header{background:#111827;border-color:#1f2937}
.back-btn{background:transparent;border:none;color:#333;font-size:14px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:6px;padding:6px 0;transition:all 0.3s}
body.dark .back-btn{color:#e5e7eb}
.back-btn:hover{opacity:0.7}
.detail-title{
  font-size:15px;
  font-weight:bold;
  color:#333;
  text-align:center;
  flex:1;
}
body.dark .detail-title{color:#e5e7eb}
.header-controls{display:flex;align-items:center;gap:10px}
.theme-toggle-detail{background:#e60012;border:none;width:40px;height:40px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;padding:8px;transition:all 0.3s}
.theme-toggle-detail:hover{background:#d5000f;transform:scale(1.1)}
.theme-toggle-detail svg{width:100%;height:100%;color:#fff;transition:transform 0.3s}
.theme-toggle-detail:hover svg{transform:rotate(20deg)}

.container{
  max-width:480px;
  width:100%;
  margin:110px auto 20px;
  background:transparent;
  border-radius:0;
  overflow:visible;
  box-shadow:none;
  transition:background 0.3s,box-shadow 0.3s;
  position:relative;
}
body.dark .container{background:transparent;box-shadow:none}

/* Header dalam container dengan warna generasi */
.container-header{
  background:var(--gen-color);
  padding:12px 18px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  border-radius:0;
  margin-bottom:0;
  position:relative;
}
.container-header .profile-title{
  font-size:16px;
  font-weight:bold;
  color:#fff;
  margin:0;
}
.container-header .show-history-btn{
  background:rgba(255,255,255,0.2);
  border:none;
  width:36px;
  height:36px;
  border-radius:50%;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:8px;
  transition:all 0.3s;
}
.container-header .show-history-btn:hover{
  background:rgba(255,255,255,0.3);
  transform:scale(1.1);
}
.container-header .show-history-btn svg{
  width:18px;
  height:18px;
  color:#fff;
}

/* FOTO: Kotak tanpa border & tanpa radius */
.photo-container{text-align:center;margin:18px 0;position:relative}
.photo{
  width:135px;
  height:190px;
  object-fit:contain;
  border-radius:0;
  transition:all 0.3s;
}
body.dark .photo{
  background:#1a1a1a;
}
.photo-error{
  width:135px;
  height:190px;
  border-radius:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#f5f5f5;
  color:#6b7280;
  font-weight:600;
  font-size:24px;
  margin:0 auto;
}
body.dark .photo-error{background:#1a1a1a;color:#9ca3af}

.member-name{text-align:center;font-size:20px;font-weight:bold;color:#333;margin:10px 0 20px}
body.dark .member-name{color:#e5e7eb}

/* PANEL KIRI - FOTO + PROGRES */
.left-panel{
  margin:0 18px 24px;
  background:transparent;
}
.left-panel .panel-title{
  font-size:16px;
  font-weight:bold;
  color:#333;
  margin-bottom:12px;
  padding-bottom:8px;
  border-bottom:2px solid #e60012;
}
body.dark .left-panel .panel-title{color:#e5e7eb;border-color:#ff3366}

/* PROGRESS MILESTONE */
.milestone-card{
  background:transparent;
  border:none;
  border-radius:0;
  padding:0;
}
.milestone-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:8px;
}
.milestone-title{
  font-size:10px;
  font-weight:600;
  color:#6b7280;
}
body.dark .milestone-title{color:#9ca3af}
.milestone-target{
  font-size:13px;
  font-weight:bold;
  color:var(--gen-color);
}
.progress-bar-container{
  height:14px;
  background:#e5e7eb;
  border-radius:7px;
  overflow:hidden;
  position:relative;
  margin-bottom:5px;
}
body.dark .progress-bar-container{background:#374151}
.progress-bar-fill{
  height:100%;
  background:var(--gen-color);
  border-radius:7px;
  transition:width 1s cubic-bezier(0.4,0,0.2,1);
  position:relative;
}
.progress-text{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  font-size:9px;
  font-weight:600;
  color:#6b7280;
  z-index:10;
}
body.dark .progress-text{color:#9ca3af}
.progress-info{
  text-align:center;
  font-size:9px;
  color:#6b7280;
  font-weight:500;
}
body.dark .progress-info{color:#9ca3af}

/* PANEL KANAN - ABOUT + SOCIAL */
.right-panel{
  margin:0 18px 24px;
  background:transparent;
}
.right-panel .panel-title{
  font-size:16px;
  font-weight:bold;
  color:#333;
  margin-bottom:12px;
  padding-bottom:8px;
  border-bottom:2px solid #e60012;
}
body.dark .right-panel .panel-title{color:#e5e7eb;border-color:#ff3366}

.info-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:8px 0;
  border-bottom:1px solid #e5e7eb;
}
.info-row:last-child{border-bottom:none}
body.dark .info-row{border-bottom-color:#374151}

.info-label{
  color:#6b7280;
  font-size:12px;
  font-weight:600;
  flex-shrink:0;
  width:90px;
}
body.dark .info-label{color:#9ca3af}
.info-value{
  color:#333;
  font-size:12px;
  font-weight:600;
  text-align:right;
  flex:1;
}
body.dark .info-value{color:#e5e7eb}

/* SOCIAL MEDIA - Tanpa card */
.social-section{
  margin-top:16px;
  background:transparent;
}
.social-title{
  font-size:16px;
  font-weight:bold;
  color:#333;
  margin-bottom:10px;
  padding-bottom:8px;
  border-bottom:2px solid #e60012;
}
body.dark .social-title{color:#e5e7eb;border-color:#ff3366}

.social-link{
  display:flex;
  align-items:center;
  padding:8px 0;
  background:transparent;
  border:none;
  border-radius:0;
  margin-bottom:4px;
  text-decoration:none;
  color:inherit;
  transition:all 0.3s;
  border-bottom:1px solid #e5e7eb;
}
.social-link:last-child{border-bottom:none}
body.dark .social-link{border-color:#374151}
.social-link:hover{transform:translateX(5px)}
.social-icon{
  width:36px;
  height:36px;
  border-radius:8px;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-shrink:0;
  background:transparent;
  border:1px solid #e5e7eb;
  transition:background 0.3s,border-color 0.3s;
}
body.dark .social-icon{background:transparent;border-color:#374151}
.social-icon svg{width:18px;height:18px;color:#333}
body.dark .social-icon svg{color:#e5e7eb}
.social-info{flex:1;margin-left:10px}
.social-name{
  font-size:11px;
  font-weight:bold;
  color:#333;
  margin-bottom:1px;
}
body.dark .social-name{color:#e5e7eb}
.social-handle{
  font-size:10px;
  color:#6b7280;
  font-weight:500;
}
body.dark .social-handle{color:#9ca3af}
.social-arrow{
  font-size:13px;
  color:#333;
  font-weight:bold;
}
body.dark .social-arrow{color:#e5e7eb}

.empty-social{
  text-align:center;
  padding:12px;
  color:#6b7280;
  font-size:12px;
  background:transparent;
  border-radius:0;
  border:1px dashed #e5e7eb;
}
body.dark .empty-social{background:transparent;color:#9ca3af;border-color:#374151}

/* Footer - Menyatu dengan konten */
.detail-footer{
  text-align:center;
  padding:12px;
  color:#6b7280;
  font-size:10px;
  border-top:1px solid #e5e7eb;
  margin-top:0;
  width:100%;
}
body.dark .detail-footer{
  color:#9ca3af;
  border-top-color:#374151;
}

/* Skeleton Loading */
.skeleton-loading{padding:20px;animation:skeleton-pulse 1.5s ease-in-out infinite}
@keyframes skeleton-pulse{0%,100%{opacity:1}50%{opacity:0.5}}
.skeleton-photo{
  width:135px;
  height:190px;
  border-radius:0;
  background:#e5e7eb;
  margin:0 auto 12px;
}
body.dark .skeleton-photo{background:#374151}
.skeleton-name{width:160px;height:24px;background:#e5e7eb;border-radius:6px;margin:0 auto 20px}
body.dark .skeleton-name{background:#374151}
.skeleton-info{width:100%;height:40px;background:#e5e7eb;border-radius:8px;margin-bottom:10px}
body.dark .skeleton-info{background:#374151}
.skeleton-info.small{width:80%;height:30px;margin:0 auto 10px}

/* Toast Notification */
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(100px);background:#333;color:#fff;padding:12px 20px;border-radius:12px;font-size:14px;font-weight:500;z-index:1001;opacity:0;transition:all 0.3s;box-shadow:0 4px 12px rgba(0,0,0,0.15)}
.toast.show{transform:translateX(-50%) translateY(0);opacity:1}
.toast.success{background:#22c55e}
.toast.error{background:#ef4444}

.loading{text-align:center;padding:80px 20px;color:#6b7280;display:flex;align-items:center;justify-content:center;gap:8px}

@keyframes spin{to{transform:rotate(360deg)}}
.spinner{display:inline-block;width:20px;height:20px;border:3px solid rgba(0,0,0,0.1);border-top-color:#9ca3af;border-radius:50%;animation:spin 0.8s linear infinite}
body.dark .spinner{border-color:rgba(255,255,255,0.1);border-top-color:#9ca3af}

/* Touch device optimizations */
@media (hover: none) and (pointer: coarse) {
  .back-btn:active,
  .theme-toggle-detail:active,
  .show-history-btn:active,
  .social-link:active {
    opacity: 0.7;
    transform: scale(0.98);
  }
}

@media (max-width:480px) {
  body{padding:0}
  .main-header{position:fixed;top:0;left:0;right:0;z-index:1001}
  .detail-header{padding:12px 15px}
  .detail-title{
    font-size:14px;
  }
  .container{
    max-width:100%;
    margin:95px 0 0;
    border-radius:0;
  }
  .container-header{
    padding:10px 14px;
  }
  .container-header .profile-title{
    font-size:14px;
  }
  .container-header .show-history-btn{
    width:32px;
    height:32px;
  }
  .container-header .show-history-btn svg{
    width:16px;
    height:16px;
  }
  .photo,.photo-error{
    width:120px;
    height:170px;
    border-radius:0;
  }
  .member-name{font-size:18px;margin:8px 0 15px}
  .left-panel, .right-panel{
    margin:0 14px 20px;
  }
  .left-panel .panel-title, .right-panel .panel-title, .social-title{
    font-size:15px;
    margin-bottom:10px;
    padding-bottom:6px;
  }
  .info-row{padding:6px 0}
  .info-label{font-size:11px;width:80px}
  .info-value{font-size:11px}
  .milestone-target{font-size:12px}
  .progress-bar-container{height:12px;border-radius:6px}
  .progress-text{font-size:8px}
  .progress-info{font-size:8px}
  .social-icon{width:32px;height:32px;border-radius:6px}
  .social-icon svg{width:16px;height:16px}
  .social-name{font-size:10px}
  .social-handle{font-size:9px}
  .social-arrow{font-size:12px}
  .detail-footer{padding:10px;font-size:9px}
  .skeleton-photo{
    width:120px;
    height:170px;
    border-radius:0;
  }
  .skeleton-name{width:140px;height:22px}
  .skeleton-info{height:35px}
  .skeleton-info.small{height:28px}
}

/* ============= DESKTOP LAYOUT - FULL ONE SIZE ============= */
@media (min-width: 1025px) {
    /* Header dua baris desktop */
    .main-header {
        position: fixed !important;
        top: 0; left: 0; right: 0;
        z-index: 1001;
    }
    .header-top-bar { background: #e60012 !important; padding: 8px 40px; }
    .header-top-title { font-size: 15px; }
    .detail-header { background: #fff; border-bottom: 1px solid #ddd; padding: 14px 40px; }
    body.dark .detail-header { background: #111827 !important; border-color: #1f2937 !important; }
    .back-btn { color: #333 !important; font-size: 16px; }
    body.dark .back-btn { color: #e5e7eb !important; }
    .detail-title { color: #333 !important; font-size: 20px; }
    body.dark .detail-title { color: #e5e7eb !important; }

    /* Container full width tanpa card, tanpa scroll */
    .container {
        max-width: 100%;
        width: 100%;
        margin: 95px 0 0; /* 2-row header */
        padding: 0;
        display: flex;
        flex-direction: column;
        min-height: calc(100vh - 95px);
        background: #fff;
        box-shadow: none;
        border-radius: 0;
    }
    body.dark .container {
        background: #111827;
    }

    /* Header dalam container untuk desktop - tanpa border radius */
    .container-header {
        width: 100%;
        padding: 16px 40px;
        background: var(--gen-color);
        border-bottom: 1px solid rgba(255,255,255,0.2);
        position: relative;
        top: 0;
    }
    .container-header .profile-title {
        font-size: 20px;
        font-weight: 600;
    }
    .container-header .show-history-btn {
        width: 44px;
        height: 44px;
    }
    .container-header .show-history-btn svg {
        width: 22px;
        height: 22px;
    }

    /* Main content - flex row, full width, tanpa card */
    .main-content {
        display: flex;
        flex: 1;
        width: 100%;
    }

    /* ===== PANEL KIRI: Foto + Progres - tanpa border radius, full height ===== */
    .left-panel {
        width: 320px;
        padding: 40px 30px;
        margin: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        background: #fff;
        border-right: 1px solid #e5e7eb;
    }
    body.dark .left-panel {
        background: #111827;
        border-right-color: #374151;
    }

    .photo-container { margin: 0 0 15px 0; }
    .photo, .photo-error { width: 160px; height: 220px; }
    .member-name { font-size: 22px; margin: 10px 0 25px 0; text-align: center; }

    .left-panel .panel-title { 
        font-size: 18px; 
        margin-bottom: 15px; 
        padding-bottom: 10px; 
        width: 100%;
        border-bottom-width: 2px;
    }

    .milestone-card { width: 100%; }
    .milestone-header { margin-bottom: 12px; }
    .milestone-title { font-size: 13px; }
    .milestone-target { font-size: 16px; }
    .progress-bar-container { height: 18px; border-radius: 9px; margin-bottom: 8px; }
    .progress-text { font-size: 11px; }
    .progress-info { font-size: 11px; }

    /* ===== PANEL KANAN: About + Social Media - tanpa card, full height ===== */
    .right-panel {
        flex: 1;
        padding: 40px 50px;
        background: #fff;
        display: flex;
        flex-direction: column;
    }
    body.dark .right-panel { background: #111827; }

    .right-panel .panel-title { 
        font-size: 20px; 
        margin-bottom: 20px; 
        padding-bottom: 12px; 
        border-bottom-width: 2px;
    }
    .info-row { padding: 14px 0; }
    .info-label { font-size: 15px; width: 140px; }
    .info-value { font-size: 15px; }

    /* Social Media - tanpa card */
    .social-section {
        width: 100%;
        margin-top: 25px;
        padding-top: 0;
        background: transparent;
    }
    .social-title { 
        font-size: 20px; 
        margin-bottom: 15px; 
        padding-bottom: 12px; 
        border-bottom-width: 2px;
    }
    .social-link { padding: 12px 0; }
    .social-icon { width: 44px; height: 44px; border-radius: 12px; }
    .social-icon svg { width: 20px; height: 20px; }
    .social-name { font-size: 15px; }
    .social-handle { font-size: 13px; }
    .social-arrow { font-size: 16px; }

    /* Footer - full width, tanpa border radius */
    .detail-footer {
        width: 100%;
        padding: 18px 40px;
        font-size: 13px;
        border: none;
        border-top: 1px solid #e5e7eb;
        background: #fff;
        margin: 0;
        text-align: center;
    }
    body.dark .detail-footer {
        background: #111827;
        border-top-color: #374151;
    }

    /* Skeleton loading full one size */
    .skeleton-loading {
        display: flex;
        flex-direction: column;
        padding: 0;
        min-height: calc(100vh - 95px);
        width: 100%;
    }
    .skeleton-header {
        height: 77px;
        background: #e5e7eb;
        width: 100%;
    }
    .skeleton-main {
        display: flex;
        flex: 1;
        width: 100%;
    }
    .skeleton-left {
        width: 320px;
        padding: 40px 30px;
        border-right: 1px solid #e5e7eb;
    }
    .skeleton-right {
        flex: 1;
        padding: 40px 50px;
    }
    .skeleton-photo {
        width: 160px;
        height: 220px;
        margin: 0 auto 20px;
    }
    .skeleton-name {
        width: 160px;
        height: 26px;
        margin: 0 auto 25px;
    }
    .skeleton-info {
        width: 100%;
        height: 45px;
        margin-bottom: 12px;
    }
    .skeleton-footer {
        height: 67px;
        background: #e5e7eb;
        width: 100%;
        border-top: 1px solid #e5e7eb;
    }
    body.dark .skeleton-header,
    body.dark .skeleton-footer,
    body.dark .skeleton-photo,
    body.dark .skeleton-name,
    body.dark .skeleton-info,
    body.dark .skeleton-left {
        background: #1f2937;
        border-color: #374151;
    }
}
</style>
</head>
<body>

<!-- Header System -->
<header class="main-header">
  <!-- Baris 1: Background merah -->
  <div class="header-top-bar">
    <span class="header-top-title">JKT48 SHOW THEATER</span>
  </div>
  <!-- Baris 2: Navigasi -->
  <div class="detail-header">
    <button onclick="goBack()" class="back-btn" aria-label="Kembali ke halaman utama">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      Kembali
    </button>
    <div class="detail-title">Anggota JKT48</div>
    <div class="header-controls">
      <button class="theme-toggle-detail" onclick="toggleTheme()" title="Toggle Dark Mode" aria-label="Ubah tema gelap/terang">
        <svg id="themeIconDetail" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"/>
        </svg>
      </button>
    </div>
  </div>
</header>

<!-- Toast Notification -->
<div id="toast" class="toast"></div>

<div class="container" id="container">
  <!-- Skeleton Loading akan diganti oleh JavaScript -->
  <div class="skeleton-loading">
    <div class="skeleton-header"></div>
    <div class="skeleton-main">
      <div class="skeleton-left">
        <div class="skeleton-photo"></div>
        <div class="skeleton-name"></div>
        <div class="skeleton-info"></div>
        <div class="skeleton-info"></div>
      </div>
      <div class="skeleton-right">
        <div class="skeleton-info"></div>
        <div class="skeleton-info"></div>
        <div class="skeleton-info"></div>
        <div class="skeleton-info"></div>
        <div class="skeleton-info"></div>
        <div class="skeleton-info"></div>
      </div>
    </div>
    <div class="skeleton-footer"></div>
  </div>
</div>

<script>
const SUPABASE_URL = "https://pprxfopqkvpeajeoxzig.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBwcnhmb3Bxa3ZwZWFqZW94emlnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyNTI4MTIsImV4cCI6MjA4MTgyODgxMn0.iXRO_dAHhtVHRLqGTresG_63RD2zIaopNXtXYNfthdg";

const urlParams = new URLSearchParams(window.location.search);
const MEMBER_NAME = urlParams.get('member');

const db = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const GEN_COLORS = {
  3: '#ec4899', 6: '#22c55e', 7: '#15803d', 8: '#1e40af',
  9: '#06b6d4', 10: '#38bdf8', 11: '#f97316', 12: '#fde68a',
  13: '#facc15', 14: '#f3c6ff'
};

let isLoading = true;

(function initializeTheme() {
  const savedTheme = localStorage.getItem('jkt48_theme') || 'light';
  const html = document.documentElement;
  const body = document.body;
  
  if (savedTheme === 'dark') {
    html.classList.add('dark');
    body.classList.add('dark');
    updateThemeIcon('dark');
  } else {
    html.classList.remove('dark');
    body.classList.remove('dark');
    updateThemeIcon('light');
  }
})();

function updateThemeIcon(theme) {
  const icon = document.getElementById('themeIconDetail');
  if (!icon) return;
  
  if (theme === 'dark') {
    icon.innerHTML = '<path d="M12,17a5,5,0,1,1,5-5A5,5,0,0,1,12,17Zm0-8a3,3,0,1,0,3,3A3,3,0,0,0,12,9Zm0-4a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41L6.34,5A1,1,0,0,0,4.93,6.34ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm.64,5.66a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71a1,1,0,0,0-1.41-1.41ZM12,19a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19Zm6.36-2.34a1,1,0,0,0-1.41,1.41l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-3.64-3.95a1,1,0,0,0,.7.29,1,1,0,0,0,.71-1.7l-.71-.71a1,1,0,0,0-1.41,1.41Z"/>';
  } else {
    icon.innerHTML = '<path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"/>';
  }
}

function toggleTheme() {
  const html = document.documentElement;
  const body = document.body;
  
  const isDark = body.classList.contains('dark');
  
  if (isDark) {
    html.classList.remove('dark');
    body.classList.remove('dark');
    localStorage.setItem('jkt48_theme', 'light');
    updateThemeIcon('light');
  } else {
    html.classList.add('dark');
    body.classList.add('dark');
    localStorage.setItem('jkt48_theme', 'dark');
    updateThemeIcon('dark');
  }
}

async function loadMember() {
  if (!MEMBER_NAME) {
    showError('Parameter member tidak ditemukan');
    return;
  }

  try {
    const { data, error } = await db
      .from('members')
      .select('*')
      .eq('name', MEMBER_NAME)
      .single();

    if (error) {
      if (error.code === 'PGRST116') {
        showError('Member tidak ditemukan');
      } else {
        throw error;
      }
      return;
    }
    
    renderMember(data);
    
  } catch (err) {
    console.error('Error:', err);
    showError('Gagal memuat data. Coba refresh halaman.');
  }
}

function renderMember(member) {
  isLoading = false;
  
  const color = GEN_COLORS[member.gen] || '#ec4899';
  const colorDark = adjustColor(color, -20);
  
  document.documentElement.style.setProperty('--gen-color', color);
  document.documentElement.style.setProperty('--gen-color-dark', colorDark);
  
  const currentShow = member.show || 0;
  
  const photoHtml = `
    <div class="photo-container">
      <img class="photo" 
           src="img/${member.name.toLowerCase()}.jpg" 
           loading="lazy"
           decoding="async"
           onerror="this.onerror=null; this.parentNode.innerHTML='<div class=\\'photo-error\\'>${member.name.charAt(0)}</div>';"
           alt="${member.name}">
    </div>
  `;
  
  const nextMilestone = Math.ceil(currentShow / 100) * 100;
  const remaining = nextMilestone - currentShow;
  const progress = ((currentShow % 100) / 100) * 100;
  
  let statusClass = 'normal';
  if (remaining === 0) {
    statusClass = 'completed';
  } else if (remaining > 0 && remaining <= 10) {
    statusClass = 'warning';
  } else {
    statusClass = 'normal';
  }
  
  document.getElementById('container').innerHTML = `
    <!-- Header dengan warna generasi dan teks Profile Member + tombol show history -->
    <div class="container-header">
      <div class="profile-title">Profile Member</div>
      <button class="show-history-btn" onclick="window.location.href='show.html?member=${encodeURIComponent(member.name)}'" title="Riwayat Show" aria-label="Riwayat Show">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
      </button>
    </div>
    
    <!-- Main Content - Flex container untuk kiri dan kanan -->
    <div class="main-content">
      <!-- PANEL KIRI: Foto + Progres -->
      <div class="left-panel">
        ${photoHtml}
        <div class="member-name">${member.name}</div>
        <div class="panel-title">Progres</div>
        <div class="milestone-card">
          <div class="milestone-header">
            <div class="milestone-title">Progres Milestone</div>
            <div class="milestone-target ${statusClass}">${nextMilestone} show</div>
          </div>
          <div class="progress-bar-container">
            <div class="progress-bar-fill" style="width:${progress}%"></div>
            <div class="progress-text">${currentShow} show</div>
          </div>
          <div class="progress-info">
            ${remaining === 0 ? 'Target tercapai!' : `${remaining} show lagi untuk mencapai target`}
          </div>
        </div>
      </div>

      <!-- PANEL KANAN: About + Social Media -->
      <div class="right-panel">
        <div class="panel-title">About</div>
        <div class="info-row">
          <div class="info-label">Nama</div>
          <div class="info-value">${member.full_name || member.name}</div>
        </div>
        <div class="info-row">
          <div class="info-label">Tanggal Lahir</div>
          <div class="info-value">${member.birth_date || '-'}</div>
        </div>
        <div class="info-row">
          <div class="info-label">Golongan Darah</div>
          <div class="info-value">${member.blood_type || '-'}</div>
        </div>
        <div class="info-row">
          <div class="info-label">Horoskop</div>
          <div class="info-value">${member.zodiac || '-'}</div>
        </div>
        <div class="info-row">
          <div class="info-label">Tinggi Badan</div>
          <div class="info-value">${member.height ? member.height + ' cm' : '-'}</div>
        </div>
        <div class="info-row">
          <div class="info-label">Generasi</div>
          <div class="info-value">${member.gen}</div>
        </div>
        ${member.status !== 'trainee' ? `
        <div class="info-row">
          <div class="info-label">Team</div>
          <div class="info-value">${member.team || '-'}</div>
        </div>
        ` : ''}
        
        <!-- SOCIAL MEDIA - Tanpa card -->
        <div class="social-section">
          <div class="social-title">Social Media</div>
          ${member.twitter || member.instagram || member.tiktok ? `
            ${member.twitter ? `
            <a href="https://twitter.com/${member.twitter}" target="_blank" class="social-link">
              <div class="social-icon twitter">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="18" height="18" fill="currentColor">
                  <path d="M357.2 48L427.8 48 273.6 224.2 455 464 313 464 201.7 318.6 74.5 464 3.8 464 168.7 275.5-5.2 48 140.4 48 240.9 180.9 357.2 48z"/>
                </svg>
              </div>
              <div class="social-info">
                <div class="social-name">Twitter</div>
                <div class="social-handle">@${member.twitter}</div>
              </div>
              <div class="social-arrow">→</div>
            </a>
            ` : ''}
            ${member.instagram ? `
            <a href="https://instagram.com/${member.instagram}" target="_blank" class="social-link">
              <div class="social-icon instagram">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                  <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                  <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                </svg>
              </div>
              <div class="social-info">
                <div class="social-name">Instagram</div>
                <div class="social-handle">@${member.instagram}</div>
              </div>
              <div class="social-arrow">→</div>
            </a>
            ` : ''}
            ${member.tiktok ? `
            <a href="https://tiktok.com/@${member.tiktok}" target="_blank" class="social-link">
              <div class="social-icon tiktok">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"/>
                </svg>
              </div>
              <div class="social-info">
                <div class="social-name">TikTok</div>
                <div class="social-handle">@${member.tiktok}</div>
              </div>
              <div class="social-arrow">→</div>
            </a>
            ` : ''}
          ` : `
            <div class="empty-social">
              <p>Social media tidak tersedia untuk member ini</p>
            </div>
          `}
        </div>
      </div>
    </div>

    <!-- Footer - Menyatu dengan konten -->
    <footer class="detail-footer">
      <p>© 2026 Show Theater. Data diperbarui secara real-time</p>
    </footer>
  `;
}

function adjustColor(color, amount) {
  const num = parseInt(color.replace('#', ''), 16);
  const r = Math.max(0, Math.min(255, (num >> 16) + amount));
  const g = Math.max(0, Math.min(255, ((num >> 8) & 0x00FF) + amount));
  const b = Math.max(0, Math.min(255, (num & 0x0000FF) + amount));
  return '#' + ((r << 16) | (g << 8) | b).toString(16).padStart(6, '0');
}

function goBack() {
  if (isLoading) return;
  
  if (window.history.length > 1) {
    window.history.back();
  } else {
    window.location.href = 'index.html';
  }
}

function showToast(message, type = 'success') {
  const toast = document.getElementById('toast');
  toast.textContent = message;
  toast.className = `toast ${type} show`;
  
  setTimeout(() => {
    toast.classList.remove('show');
  }, 3000);
}

function showError(message) {
  isLoading = false;
  
  document.getElementById('container').innerHTML = `
    <div class="content" style="padding:60px 20px;text-align:center">
      <div style="font-size:18px;font-weight:bold;color:#333;margin-bottom:10px">${message}</div>
      <div style="color:#6b7280;margin-bottom:30px">Member tidak ditemukan atau terjadi kesalahan</div>
      <button onclick="goBack()" style="background:#e60012;color:#fff;border:none;border-radius:12px;padding:12px 24px;font-size:14px;font-weight:600;cursor:pointer">
        Kembali
      </button>
    </div>
  `;
}

window.addEventListener('DOMContentLoaded', () => {
  loadMember();
});
</script>
</body>
</html>