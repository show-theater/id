<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jadwal Show - JKT48 Theater</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
<style>
/* CSS tetap sama */
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial,sans-serif;background:#f5f5f5;color:#333;min-height:100vh;transition:background 0.3s,color 0.3s}
body.dark{background:#0a0e1a;color:#e5e7eb}
header{background:#e60012;text-align:center;padding:20px 60px 20px 20px;font-size:24px;font-weight:bold;color:#fff;position:relative;display:flex;align-items:center;justify-content:center}
.back-btn{position:absolute;left:20px;top:50%;transform:translateY(-50%);background:rgba(255,255,255,0.2);border:none;color:#fff;width:40px;height:40px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.3s}
.back-btn:hover{background:rgba(255,255,255,0.3)}
.theme-toggle{position:absolute;right:20px;top:50%;transform:translateY(-50%);background:rgba(255,255,255,0.2);border:none;color:#fff;width:40px;height:40px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;padding:8px;transition:all 0.3s}
.theme-toggle:hover{background:rgba(255,255,255,0.3)}
.theme-toggle svg{width:20px;height:20px}
body.dark .back-btn,body.dark .theme-toggle{background:rgba(0,0,0,0.2)}
.container{max-width:1200px;margin:0 auto;padding:20px}

.calendar-container{background:#fff;border-radius:12px;padding:20px;margin-bottom:20px;border:1px solid #e5e7eb}
body.dark .calendar-container{background:#1b1f3a;border-color:#2d3548}
.calendar-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding:0 10px}
.calendar-title{font-size:18px;font-weight:bold;color:#e60012;text-align:center;flex:1}
body.dark .calendar-title{color:#f87171}
.calendar-nav{display:flex;gap:8px}
.calendar-nav button{background:#f0f0f0;border:none;width:36px;height:36px;border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s}
.calendar-nav button:hover{background:#e0e0e0}
body.dark .calendar-nav button{background:#2d3548;color:#9ca3af}
body.dark .calendar-nav button:hover{background:#3d4558}
.calendar-nav button svg{width:18px;height:18px}
.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;margin-top:10px}
.calendar-day-header{padding:12px 0;text-align:center;font-size:12px;font-weight:bold;color:#666;text-transform:uppercase}
body.dark .calendar-day-header{color:#9ca3af}
.calendar-day{padding:12px 0;text-align:center;border-radius:8px;cursor:pointer;transition:all 0.2s;position:relative;min-height:50px;display:flex;flex-direction:column;align-items:center;justify-content:center}
.calendar-day:hover{background:#f0f0f0}
.calendar-day.active{background:#e60012;color:#fff}
.calendar-day.today{border:2px solid #e60012}
.calendar-day.other-month{color:#999}
body.dark .calendar-day:hover{background:#2d3548}
body.dark .calendar-day.active{background:#f87171}
body.dark .calendar-day.today{border-color:#f87171}
body.dark .calendar-day.other-month{color:#666}
.calendar-indicators{margin-top:4px;display:flex;gap:3px;justify-content:center;flex-wrap:wrap}
.calendar-indicator{width:6px;height:6px;border-radius:50%}

.show-card{background:#fff;border-radius:12px;padding:20px;margin-bottom:16px;cursor:pointer;border:1px solid #e5e7eb;transition:all 0.3s}
.show-card:hover{background:#f9fafb;border-color:#d1d5db}
body.dark .show-card{background:#1b1f3a;border-color:#2d3548}
body.dark .show-card:hover{background:#1f2437;border-color:#3d4558}
.show-card.show-live{border:2px solid #ef4444;background:#fff5f5;animation:live-glow 2s ease-in-out infinite}
body.dark .show-card.show-live{background:#1f1515;border-color:#ef4444}
@keyframes live-glow{0%,100%{box-shadow:0 2px 8px rgba(239,68,68,0.3)}50%{box-shadow:0 4px 16px rgba(239,68,68,0.6)}}
.live-indicator{display:inline-flex;align-items:center;gap:6px;background:#ef4444;color:#fff;padding:4px 10px;border-radius:12px;font-size:11px;font-weight:bold;margin-right:8px;animation:pulse-live 2s infinite}
.live-dot-pulse{width:8px;height:8px;background:#fff;border-radius:50%;animation:pulse-dot 1.5s ease-in-out infinite}
@keyframes pulse-live{0%,100%{opacity:1}50%{opacity:0.85}}
@keyframes pulse-dot{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.6;transform:scale(0.8)}}
.show-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px;flex-wrap:wrap;gap:12px}
.show-title{font-size:18px;font-weight:bold;color:#e60012;flex:1}
body.dark .show-title{color:#f87171}
.show-time{font-size:14px;font-weight:bold;color:#666;padding:6px 12px;background:#f0f0f0;border-radius:12px;white-space:nowrap}
body.dark .show-time{background:#0a0e1a;color:#9ca3af}
.show-date{font-size:12px;color:#9ca3af;margin-bottom:8px}
.show-members{font-size:13px;color:#666;line-height:1.6}
body.dark .show-members{color:#9ca3af}
.setlist-badge{display:inline-block;padding:4px 10px;border-radius:12px;font-size:11px;font-weight:bold;margin-left:8px;color:#fff}
.loading{text-align:center;padding:60px 20px;color:#9ca3af}
.spinner{display:inline-block;width:40px;height:40px;border:4px solid rgba(0,0,0,0.1);border-top-color:#e60012;border-radius:50%;animation:spin 0.8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
body.dark .spinner{border-color:rgba(255,255,255,0.1);border-top-color:#f87171}
.no-shows{text-align:center;padding:60px 20px;color:#9ca3af;font-size:14px}

@media (max-width:767px){
header{padding:15px 50px 15px 50px;font-size:20px}
.back-btn,.theme-toggle{width:35px;height:35px;left:10px}
.theme-toggle{right:10px;left:auto}
.container{padding:15px}
.show-header{flex-direction:column;align-items:flex-start}
.show-time{width:100%}
.calendar-header{padding:0 5px}
.calendar-day-header{font-size:10px;padding:8px 0}
.calendar-day{padding:10px 0;font-size:14px;min-height:45px}
.calendar-nav button{width:32px;height:32px}
.calendar-nav button svg{width:16px;height:16px}
.calendar-indicator{width:5px;height:5px}
}

/* ============= DESKTOP LAYOUT ============= */
@media (min-width: 1025px) {
    .container {
        display: flex;
        gap: 30px;
        max-width: 1400px;
        padding: 30px;
        align-items: flex-start;
    }
    
    .calendar-container {
        flex: 0 0 400px;
        margin-bottom: 0;
        position: sticky;
        top: 30px;
    }
    
    #showList {
        flex: 1;
        min-width: 0;
    }
    
    .calendar-title {
        font-size: 20px;
    }
    
    .calendar-grid {
        gap: 10px;
    }
    
    .calendar-day {
        padding: 15px 0;
        min-height: 60px;
        font-size: 16px;
    }
    
    .calendar-day-header {
        padding: 15px 0;
        font-size: 13px;
    }
    
    .calendar-indicator {
        width: 8px;
        height: 8px;
    }
    
    .show-card {
        margin-bottom: 20px;
        padding: 25px;
    }
    
    .show-title {
        font-size: 20px;
    }
    
    .show-time {
        font-size: 16px;
        padding: 8px 16px;
    }
    
    .show-date {
        font-size: 14px;
    }
    
    .show-members {
        font-size: 15px;
    }
    
    .setlist-badge {
        font-size: 12px;
        padding: 5px 12px;
    }
    
    .live-indicator {
        font-size: 12px;
        padding: 6px 12px;
    }
    
    .live-dot-pulse {
        width: 10px;
        height: 10px;
    }
    
    header {
        padding: 25px 80px 25px 80px;
        font-size: 28px;
    }
    
    .back-btn, .theme-toggle {
        width: 50px;
        height: 50px;
    }
    
    .back-btn {
        left: 30px;
    }
    
    .theme-toggle {
        right: 30px;
    }
}
</style>
</head>
<body>
<header>
<button class="back-btn" onclick="goBack()" title="Kembali">
<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
</button>
JADWAL SHOW
<button class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark Mode">
<svg id="themeIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"/></svg>
</button>
</header>

<div class="container">
<div class="calendar-container">
<div class="calendar-header">
<div class="calendar-nav">
<button onclick="changeMonth(-1)" title="Bulan sebelumnya">
<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
<path fill-rule="evenodd" d="M12 8a.5.5 0 0 1-.5.5H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5a.5.5 0 0 1 .5.5z"/>
</svg>
</button>
</div>
<h3 class="calendar-title" id="currentMonth">Januari 2024</h3>
<div class="calendar-nav">
<button onclick="changeMonth(1)" title="Bulan berikutnya">
<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
<path fill-rule="evenodd" d="M4 8a.5.5 0 0 1 .5-.5h5.793L8.146 5.354a.5.5 0 1 1 .708-.708l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708L10.293 8.5H4.5A.5.5 0 0 1 4 8"/>
</svg>
</button>
</div>
</div>
<div class="calendar-grid" id="calendar"></div>
</div>

<div id="showList">
<div class="loading">
<div class="spinner"></div>
<div style="margin-top:16px">Memuat jadwal...</div>
</div>
</div>
</div>

<script>
const SUPABASE_URL="https://pprxfopqkvpeajeoxzig.supabase.co";
const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBwcnhmb3Bxa3ZwZWFqZW94emlnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyNTI4MTIsImV4cCI6MjA4MTgyODgxMn0.iXRO_dAHhtVHRLqGTresG_63RD2zIaopNXtXYNfthdg";
const db=supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

// ============= FUNGSI THEME GLOBAL =============
(function initializeTheme() {
  const savedTheme = localStorage.getItem('jkt48_theme') || 'light';
  const html = document.documentElement;
  const body = document.body;
  
  if (savedTheme === 'dark') {
    html.classList.add('dark');
    body.classList.add('dark');
    updateThemeIcon('dark');
  } else {
    html.classList.remove('dark');
    body.classList.remove('dark');
    updateThemeIcon('light');
  }
})();

function updateThemeIcon(theme) {
  const icon = document.getElementById('themeIcon');
  if (!icon) return;
  
  if (theme === 'dark') {
    // Icon matahari untuk dark mode
    icon.innerHTML = '<path d="M12,17a5,5,0,1,1,5-5A5,5,0,0,1,12,17Zm0-8a3,3,0,1,0,3,3A3,3,0,0,0,12,9Zm0-4a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41L6.34,5A1,1,0,0,0,4.93,6.34ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm.64,5.66a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71a1,1,0,0,0-1.41-1.41ZM12,19a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19Zm6.36-2.34a1,1,0,0,0-1.41,1.41l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-3.64-3.95a1,1,0,0,0,.7.29,1,1,0,0,0,.71-1.7l-.71-.71a1,1,0,0,0-1.41,1.41Z"/>';
  } else {
    // Icon bulan untuk light mode
    icon.innerHTML = '<path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"/>';
  }
}

function toggleTheme() {
  const html = document.documentElement;
  const body = document.body;
  
  const isDark = body.classList.contains('dark');
  
  if (isDark) {
    html.classList.remove('dark');
    body.classList.remove('dark');
    localStorage.setItem('jkt48_theme', 'light');
    updateThemeIcon('light');
  } else {
    html.classList.add('dark');
    body.classList.add('dark');
    localStorage.setItem('jkt48_theme', 'dark');
    updateThemeIcon('dark');
  }
}
// ============= END FUNGSI THEME =============

function saveSelectedDate(dateStr) {
    localStorage.setItem('jkt48_selected_date', dateStr);
}

function loadSelectedDate() {
    const savedDate = localStorage.getItem('jkt48_selected_date');
    return savedDate || new Date().toISOString().split('T')[0];
}

let currentDate = loadSelectedDate();
let allShows=[];
let currentMonth=moment(currentDate);

function goBack(){
window.location.href='index.html';
}

async function loadSchedule(){
try{
const today=new Date();
const startDate=new Date(today.getFullYear(), today.getMonth() - 1, 1);
const endDate=new Date(today.getFullYear(), today.getMonth() + 2, 0);
const startStr=startDate.toISOString().split('T')[0];
const endStr=endDate.toISOString().split('T')[0];

const{data,error}=await db.from('setlist_performance').select('*').gte('show_date',startStr).lte('show_date',endStr).order('show_date',{ascending:true}).order('show_time',{ascending:true});
if(error)throw error;
allShows=data||[];
renderCalendar();
renderShows(currentDate);
}catch(err){
console.error('Error:',err);
document.getElementById('showList').innerHTML='<div class="no-shows">Gagal memuat jadwal</div>';
}
}

function isShowLiveOrStartingSoon(showDate, showTime) {
const now = new Date();
const showDateTime = new Date(showDate + 'T' + showTime);
const fifteenMinutesBefore = new Date(showDateTime.getTime() - (15 * 60 * 1000));
const fifteenMinutesAfter = new Date(showDateTime.getTime() + (15 * 60 * 1000));
return now >= fifteenMinutesBefore && now <= fifteenMinutesAfter;
}

function getSetlistColor(setlistName, memberCount) {
if (!setlistName) return '#e60012';
const setlistLower = setlistName.toLowerCase().trim();
  
if(setlistLower.includes('te wo tsunaginagara') || 
   setlistLower.includes('tewo') ||
   setlistLower.includes('tsunaginagara') ||
   setlistName.includes('Te Wo Tsunaginagara')) {
return '#FF69B4';
} else if(setlistLower.includes('ramune')) {
return '#00CED1';
} else if(setlistLower.includes('pertaruhan')) {
return '#D30000';
} else if(setlistLower.includes('pajama')) {
return '#00006d';
} else {
return '#e60012';
}
}

function getSetlistsForDate(dateStr) {
const showsOnDate = allShows.filter(s => s.show_date === dateStr);
if(showsOnDate.length === 0) return [];
  
const setlistGroups = {};
showsOnDate.forEach(show => {
const setlistKey = show.setlist_name || 'Unknown';
if (!setlistGroups[setlistKey]) {
setlistGroups[setlistKey] = [];
}
setlistGroups[setlistKey].push(show);
});

const uniqueSetlists = [];
for (const [setlistName, shows] of Object.entries(setlistGroups)) {
const memberCount = shows.length;
const color = getSetlistColor(setlistName, memberCount);
uniqueSetlists.push({
name: setlistName,
color: color,
count: shows.length
});
}

uniqueSetlists.sort((a, b) => {
const priorityOrder = {
'#FF69B4': 1,
'#00CED1': 2,
'#D30000': 3,
'#00006d': 4,
'#e60012': 5
};
return (priorityOrder[a.color] || 6) - (priorityOrder[b.color] || 6);
});

return uniqueSetlists.slice(0, 3);
}

function createIndicatorsHTML(dateStr) {
const setlists = getSetlistsForDate(dateStr);
if(setlists.length === 0) return '';

let indicatorsHTML = '<div class="calendar-indicators">';
setlists.forEach(setlist => {
indicatorsHTML += `<span class="calendar-indicator" style="background:${setlist.color}" title="${setlist.name}"></span>`;
});
indicatorsHTML += '</div>';

return indicatorsHTML;
}

function renderCalendar(){
const calendarEl=document.getElementById('calendar');
const monthYearEl=document.getElementById('currentMonth');
const monthNames=['Januari','Februari','Maret','April','Mei','Juni','Juli','Agustus','September','Oktober','November','Desember'];
const dayNames=['Min','Sen','Sel','Rab','Kam','Jum','Sab'];

currentMonth = moment(currentDate);

monthYearEl.textContent=`${monthNames[currentMonth.month()]} ${currentMonth.year()}`;

const startOfMonth=currentMonth.clone().startOf('month');
const endOfMonth=currentMonth.clone().endOf('month');
const startDate=startOfMonth.clone().startOf('week');
const endDate=endOfMonth.clone().endOf('week');

let html='';

for(let i=0;i<7;i++){
html+=`<div class="calendar-day-header">${dayNames[i]}</div>`;
}

const currentDay=moment();
let date=startDate.clone();

while(date.isBefore(endDate)||date.isSame(endDate,'day')){
const dateStr=date.format('YYYY-MM-DD');
const isToday=date.isSame(currentDay,'day');
const isCurrentMonth=date.month()===currentMonth.month();
const isActive=dateStr===currentDate;
const hasShow=allShows.some(show=>show.show_date===dateStr);

let dayClass='calendar-day';
if(!isCurrentMonth)dayClass+=' other-month';
if(isToday)dayClass+=' today';
if(isActive)dayClass+=' active';

const indicatorsHTML = hasShow ? createIndicatorsHTML(dateStr) : '';

html+=`<div class="${dayClass}" data-date="${dateStr}" onclick="selectDate('${dateStr}')">
<div>${date.date()}</div>
${indicatorsHTML}
</div>`;
date.add(1,'day');
}

calendarEl.innerHTML=html;
}

function changeMonth(direction){
currentMonth.add(direction,'month');
renderCalendar();
}

function selectDate(date){
currentDate = date;
saveSelectedDate(date);
    
const today = moment();
if(today.month()!==moment(date).month()){
currentMonth = moment(date);
}
renderCalendar();
renderShows(date);
}

function renderShows(date){
const filtered=allShows.filter(s=>s.show_date===date);
const container=document.getElementById('showList');
if(filtered.length===0){
container.innerHTML='<div class="no-shows">Tidak ada show pada tanggal ini</div>';
return;
}
const grouped={};
filtered.forEach(show=>{
const key=`${show.setlist_name}_${show.show_time}`;
if(!grouped[key]){
grouped[key]={
setlist:show.setlist_name,
time:show.show_time,
date:show.show_date,
members:[],
isBirthday:show.is_birthday_show,
birthdayMember:show.birthday_member
};
}
grouped[key].members.push(show.name);
});
container.innerHTML='';
Object.values(grouped).forEach(show=>{
const card=document.createElement('div');
card.className='show-card';
const isLive = isShowLiveOrStartingSoon(show.date, show.time);
if(isLive) card.classList.add('show-live');
card.onclick=()=>openShowDetail(show.setlist,show.date);
const memberCount=show.members.length;
const badgeColor=getSetlistColor(show.setlist, memberCount);
let title=show.setlist;
if(show.isBirthday&&show.birthdayMember)title+=` (STS ${show.birthdayMember})`;
const dayNames=['Minggu','Senin','Selasa','Rabu','Kamis','Jumat','Sabtu'];
const monthNames=['Januari','Februari','Maret','April','Mei','Juni','Juli','Agustus','September','Oktober','November','Desember'];
const d=new Date(show.date);
const dayName=dayNames[d.getDay()];
const dayNumber=d.getDate();
const monthName=monthNames[d.getMonth()];
const year=d.getFullYear();
card.innerHTML=`
<div class="show-header">
<div class="show-title">
${isLive ? '<span class="live-indicator"><span class="live-dot-pulse"></span>LIVE</span>' : ''}
${title}<span class="setlist-badge" style="background:${badgeColor}">${memberCount} member</span>
</div>
<div class="show-time">${show.time.slice(0,5)} WIB</div>
</div>
<div class="show-date">${dayName}, ${dayNumber} ${monthName} ${year}</div>
<div class="show-members">${show.members.sort().join(', ')}</div>
`;
container.appendChild(card);
});
}

function openShowDetail(setlist,date){
window.location.href=`liveshow.html?setlist=${encodeURIComponent(setlist)}&date=${date}`;
}

document.addEventListener('DOMContentLoaded',()=>{
loadSchedule();
});
</script>
</body>
</html>