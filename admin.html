<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - JKT48 Show Theater</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial,sans-serif;background:#f5f5f5;color:#333;min-height:100vh;padding-bottom:60px;transition:background 0.3s,color 0.3s}
body.dark{background:#0a0e1a;color:#e5e7eb}
header{background:#e60012;padding:15px 20px;font-size:20px;font-weight:bold;color:#fff;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;min-height:60px}
.header-left{display:flex;align-items:center;gap:8px;flex:1;min-width:0}
.header-title{font-size:18px;font-weight:bold;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.admin-badge{background:#fff;color:#e60012;padding:4px 10px;border-radius:20px;font-size:11px;font-weight:bold;white-space:nowrap;flex-shrink:0}
.header-logout-btn{background:transparent;border:none;color:#fff;width:40px;height:40px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;padding:8px;transition:all 0.3s;flex-shrink:0}
.header-logout-btn:hover{background:rgba(255,80,80,0.4);transform:scale(1.1)}
.header-logout-btn svg{width:22px;height:22px}
.header-theme-toggle{background:rgba(255,255,255,0.2);border:none;color:#fff;width:40px;height:40px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;padding:8px;transition:all 0.3s;flex-shrink:0}
.header-theme-toggle:hover{background:rgba(255,255,255,0.3);transform:scale(1.1)}
.header-theme-toggle svg{width:22px;height:22px;transition:transform 0.5s cubic-bezier(0.68,-0.55,0.265,1.55)}
.header-theme-toggle:active svg{transform:scale(0.9)}
body.dark .header-theme-toggle{background:rgba(0,0,0,0.2)}
body.dark .header-theme-toggle:hover{background:rgba(0,0,0,0.35)}
.top{padding:15px 20px;background:#fff;border-bottom:1px solid #ddd;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;transition:background 0.3s,border-color 0.3s}
body.dark .top{background:#1b1f3a;border-bottom:1px solid #2d3548}
.search-box{display:inline-block;width:100%;max-width:400px;position:relative;flex:1}

/* ===== SEARCH ICON ===== */
.search-icon{
    position:absolute;
    right:14px;
    top:50%;
    transform:translateY(-50%);
    display:flex;
    align-items:center;
    justify-content:center;
    pointer-events:none;
    z-index:2;
    color:#9ca3af;
    transition:color 0.3s;
}
.search-icon svg{width:16px;height:16px;display:block}
body.dark .search-icon{color:#6b7280}
.search-box:focus-within .search-icon{color:#e60012}
body.dark .search-box:focus-within .search-icon{color:#f87171}
.search-icon.hidden{display:none}
/* ======================== */

.search-box input{width:100%;padding:12px 44px 12px 20px;border-radius:25px;border:2px solid #D3D3D3;background:#fff;font-size:14px;outline:none;color:#333;transition:all 0.3s}
.search-box input::placeholder{color:#aaaaaa;opacity:1}
.search-box input:focus{border-color:#e60012}
body.dark .search-box input{background:#0a0e1a;color:#e5e7eb;border-color:#2d3548}
body.dark .search-box input::placeholder{color:#3d4558;opacity:1}
body.dark .search-box input:focus{border-color:#f87171}
.search-clear-btn{position:absolute;right:14px;top:50%;transform:translateY(-50%);background:transparent;border:none;width:22px;height:22px;display:none;align-items:center;justify-content:center;cursor:pointer;padding:0;transition:transform 0.2s,opacity 0.2s;flex-shrink:0;z-index:3;opacity:0.5}
.search-clear-btn:hover{transform:translateY(-50%) scale(1.2);opacity:1}
.search-clear-btn:active{transform:translateY(-50%) scale(0.9)}
.search-clear-btn svg{width:14px;height:14px;display:block;stroke:#666}
.search-clear-btn:hover svg{stroke:#e60012}
.search-clear-btn.visible{display:flex}
body.dark .search-clear-btn svg{stroke:#9ca3af}
body.dark .search-clear-btn:hover svg{stroke:#f87171}

/* ===== TOP ACTION BUTTONS ===== */
.top-actions{display:flex;gap:8px;align-items:center;flex-shrink:0}
textarea{font-family:Arial,sans-serif;max-height:150px;min-height:100px;resize:vertical}
body.dark textarea{background:#0a0e1a;color:#e5e7eb;border-color:#374151}
button{border:none;border-radius:20px;padding:10px 20px;font-weight:bold;cursor:pointer;font-size:14px;transition:opacity 0.15s,transform 0.1s}
button:active{transform:scale(0.97)}
.bulk-btn{background:#f59e0b;color:#fff}
.edit-show-btn{background:#3b82f6;color:#fff}
.logout-btn{background:#22c55e;color:#fff}
.activity-section{padding:15px 20px;background:#fff;border-bottom:1px solid #ddd;transition:background 0.3s,border-color 0.3s}
body.dark .activity-section{background:#111827;border-bottom:1px solid #1f2937}
.activity-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.activity-title{font-size:16px;font-weight:bold}
.clear-log-btn{background:#ef4444;color:#fff;padding:8px 16px;font-size:12px;border-radius:12px}
.activity-log{background:#f9fafb;border-radius:12px;padding:15px;border:1px solid #e5e7eb;max-height:200px;overflow-y:auto}
body.dark .activity-log{background:#1f2937;border-color:#374151}
.activity-item{display:flex;align-items:center;gap:10px;padding:10px;margin-bottom:6px;background:#fff;border-radius:8px;border-left:3px solid var(--color)}
body.dark .activity-item{background:#111827}
.activity-icon{font-size:18px}
.activity-content{flex:1;min-width:0}
.activity-text{font-size:12px;font-weight:600;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.activity-time{font-size:10px;color:#666;margin-top:2px}
body.dark .activity-time{color:#9ca3af}
.activity-empty{text-align:center;padding:30px;color:#999;font-size:13px}
.filters{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;padding:12px 15px;background:#fff;border-bottom:1px solid #ddd;transition:background 0.3s,border-color 0.3s}
body.dark .filters{background:#111827;border-bottom:1px solid #1f2937}
.filter{padding:8px 14px;font-size:12px;border-radius:20px;border:2px solid transparent;cursor:pointer;font-weight:bold;background:#f0f0f0;color:#333;transition:all 0.3s;white-space:nowrap}
.filter.active{border:2px solid #e60012 !important;box-shadow:0 0 0 1px rgba(230,0,18,0.1)}
.filter.all{background:#e60012;color:#fff}
.filter.inti{background:#22c55e;color:#fff}
.filter.trainee{background:#f59e0b;color:#fff}
body.dark .filter{background:#1f2937;color:#e5e7eb}
.stats{text-align:center;padding:8px 15px;font-size:12px;color:#666;background:#fff;border-bottom:1px solid #ddd;transition:background 0.3s}
body.dark .stats{background:#0a0e1a;color:#9ca3af}
.container{padding:20px;display:grid;gap:14px;max-width:1400px;margin:0 auto;width:100%}
@media (max-width:767px){.container{grid-template-columns:repeat(4,1fr);gap:8px;padding:10px}}
@media (min-width:768px) and (max-width:1023px){.container{grid-template-columns:repeat(5,1fr);gap:12px;padding:16px}}
@media (min-width:1024px){.container{grid-template-columns:repeat(7,1fr);gap:14px;padding:20px}}
@media (min-width:1280px){.container{grid-template-columns:repeat(9,1fr);gap:15px;padding:24px}}

/* ===== CARD ===== */
.card{
  background:#fff;
  border-radius:16px;
  padding:0;
  text-align:center;
  overflow:hidden;
  box-shadow:0 2px 12px rgba(0,0,0,0.08);
  position:relative;
  transition:transform 0.2s,box-shadow 0.25s;
  border:2px solid transparent;
}
.card:hover{transform:translateY(-4px);box-shadow:0 10px 28px rgba(0,0,0,0.15)}
.card.trainee{border-color:#f59e0b}
body.dark .card{background:#151c2e;box-shadow:0 2px 12px rgba(0,0,0,0.3)}

/* Photo */
.avatar-wrap{width:100%;aspect-ratio:3/4;position:relative;overflow:hidden;background:#1e1e2e;display:block}
.avatar{width:100%;height:100%;object-fit:cover;display:block;position:absolute;top:0;left:0;transition:transform 0.35s}
.card:hover .avatar{transform:scale(1.07)}
body.dark .avatar-wrap{background:#1e1e2e}
.avatar-placeholder{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:#1e1e2e;color:#5a5a7a;font-size:28px;font-weight:bold}

/* Gradient overlay at bottom of photo */
.avatar-overlay{
  position:absolute;bottom:0;left:0;right:0;
  height:45%;
  background:linear-gradient(to top, rgba(0,0,0,0.65) 0%, transparent 100%);
  z-index:2;
  pointer-events:none;
}

/* Status badge */
.status-badge{
  position:absolute;top:8px;left:8px;
  color:#fff;font-size:8px;font-weight:800;
  padding:3px 8px;border-radius:20px;
  text-transform:uppercase;z-index:10;
  white-space:nowrap;letter-spacing:0.5px;
  backdrop-filter:blur(4px);
  background:rgba(34,197,94,0.92);
  border:1px solid rgba(255,255,255,0.25);
}
.status-badge.trainee{background:rgba(245,158,11,0.92)}
.status-badge.graduated{background:rgba(107,114,128,0.92)}

/* Footer */
.card-footer{
  padding:10px 10px 8px;
  background:var(--gen-color);
  position:relative;
}

/* Gen badge */
.gen-badge{
  display:inline-flex;align-items:center;
  background:rgba(0,0,0,0.18);color:#fff;
  font-size:9px;font-weight:700;
  padding:2px 8px;border-radius:20px;
  margin-bottom:5px;letter-spacing:0.3px;
  border:1px solid rgba(255,255,255,0.15);
}

/* Name */
.name{
  font-weight:800;font-size:12px;
  color:#fff;margin-bottom:2px;
  white-space:nowrap;overflow:hidden;
  text-overflow:ellipsis;
  text-shadow:0 1px 3px rgba(0,0,0,0.3);
}

/* Show count */
.show{
  font-size:11px;font-weight:700;
  color:rgba(255,255,255,0.95);
  margin-bottom:6px;
  display:flex;align-items:center;
  justify-content:center;gap:3px;
}
.show-num{
  font-size:15px;font-weight:900;
  color:#fff;line-height:1;
}

/* Progress bar */
.bar{height:3px;background:rgba(0,0,0,0.2);border-radius:2px;overflow:hidden;margin-bottom:8px}
.bar span{display:block;height:100%;background:rgba(255,255,255,0.7);border-radius:2px;transition:width 0.5s ease}

/* Admin controls */
.admin-controls{display:flex;gap:5px;justify-content:center}
.admin-controls button{
  min-width:30px;min-height:30px;
  width:30px;height:30px;
  border-radius:10px;
  background:rgba(0,0,0,0.22);
  color:#fff;padding:0;
  font-size:17px;font-weight:700;
  display:flex;align-items:center;justify-content:center;
  transition:background 0.15s,transform 0.1s;
  border:1px solid rgba(255,255,255,0.15);
}
.admin-controls button:hover{background:rgba(0,0,0,0.4);transform:scale(1.1)}
.admin-controls button:active{transform:scale(0.93)}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center;z-index:999;padding:20px;backdrop-filter:blur(8px)}
.modal-box{background:#fff;padding:28px;border-radius:20px;width:90%;max-width:380px;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,0.5);position:relative}
body.dark .modal-box{background:#111827}
.modal-theme-toggle{position:absolute;top:20px;right:20px;background:#e60012;border:none;color:#fff;width:36px;height:36px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;padding:7px}
.modal-theme-toggle svg{width:100%;height:100%}
.modal-box h3{margin:0 0 8px;font-size:20px}
.modal-box p{margin:0 0 15px;font-size:14px;color:#666}
body.dark .modal-box p{color:#9ca3af}
.modal-box input,.modal-box select,.modal-box textarea{width:100%;padding:12px;border-radius:12px;border:2px solid #ddd;background:#fff;color:#333;font-size:14px;outline:none;margin-bottom:10px}
body.dark .modal-box input,body.dark .modal-box select,body.dark .modal-box textarea{background:#0a0e1a;color:#e5e7eb;border-color:#374151}
input[type="date"]{color-scheme:light}
body.dark input[type="date"]{color-scheme:dark}
.input-label{display:block;font-size:12px;font-weight:600;color:#666;margin-bottom:6px;margin-top:10px}
body.dark .input-label{color:#9ca3af}
.modal-buttons{display:flex;gap:10px;margin-top:20px;position:sticky;bottom:0;background:inherit;padding-top:10px;z-index:10}
.btn-cancel{background:#e5e7eb;color:#333}
body.dark .btn-cancel{background:#374151;color:#e5e7eb}
.btn-confirm{background:#ef4444;color:#fff}
.btn-add{background:#22c55e;color:#fff}
.error{color:#ef4444;font-size:12px;display:none;margin:8px 0 12px;font-weight:600}
.msg{grid-column:1/-1;text-align:center;padding:40px 20px;color:#999;background:#fff;border-radius:12px;margin:20px}
body.dark .msg{background:#111827;color:#6b7280}
.loading{display:flex;align-items:center;justify-content:center;gap:8px;grid-column:1/-1;padding:60px 20px}
@keyframes spin{to{transform:rotate(360deg)}}
.spinner{display:inline-block;width:32px;height:32px;border:3px solid rgba(0,0,0,0.1);border-top-color:#f59e0b;border-radius:50%;animation:spin 0.8s linear infinite}
body.dark .spinner{border-color:rgba(255,255,255,0.1);border-top-color:#f59e0b}

/* Notification System - minimal toast */
.notification {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 9999;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    pointer-events: none;
}
.notification-item {
    pointer-events: auto;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    border-radius: 24px;
    font-size: 13px;
    font-weight: 600;
    box-shadow: 0 4px 16px rgba(0,0,0,0.18);
    animation: toastIn 0.25s cubic-bezier(0.34,1.56,0.64,1);
    white-space: nowrap;
    max-width: 90vw;
    backdrop-filter: blur(8px);
}
.notification-item.hiding {
    animation: toastOut 0.2s ease-in forwards;
}
/* Dot indicator */
.notification-dot {
    width: 7px; height: 7px;
    border-radius: 50%;
    flex-shrink: 0;
}
.notification-success  { background: rgba(20,30,20,0.88);  color: #4ade80; border: 1px solid rgba(74,222,128,0.25); }
.notification-error    { background: rgba(30,10,10,0.88);  color: #f87171; border: 1px solid rgba(248,113,113,0.25); }
.notification-warning  { background: rgba(30,20,5,0.88);   color: #fbbf24; border: 1px solid rgba(251,191,36,0.25); }
.notification-info     { background: rgba(10,15,30,0.88);  color: #60a5fa; border: 1px solid rgba(96,165,250,0.25); }
.notification-success .notification-dot  { background: #4ade80; }
.notification-error .notification-dot    { background: #f87171; }
.notification-warning .notification-dot  { background: #fbbf24; }
.notification-info .notification-dot     { background: #60a5fa; }

@keyframes toastIn {
    from { opacity:0; transform:translateY(12px) scale(0.95); }
    to   { opacity:1; transform:translateY(0) scale(1); }
}
@keyframes toastOut {
    from { opacity:1; transform:translateY(0) scale(1); }
    to   { opacity:0; transform:translateY(8px) scale(0.95); }
}

/* Toast replacement */
.toast{display:none}



.setlist-info{background:#f9fafb;border:1px solid #e5e7eb;border-radius:8px;padding:10px;margin-bottom:10px;font-size:12px;color:#666}
body.dark .setlist-info{background:#1f2937;border-color:#374151;color:#9ca3af}
.setlist-badge{display:inline-block;background:#f59e0b;color:#fff;padding:3px 8px;border-radius:6px;font-size:10px;font-weight:bold;margin-right:6px}
.tip-text{font-size:11px;color:#666;margin-bottom:10px;padding:8px;background:#f9fafb;border-radius:8px;display:flex;align-items:center;line-height:1.4}
body.dark .tip-text{background:#1f2937;color:#9ca3af}



/* Non-Show Activity CSS */
.non-show-section {
  margin: 15px 0;
  padding: 15px;
  background: #f0fdf4;
  border-radius: 12px;
  border: 2px solid #86efac;
}
body.dark .non-show-section {
  background: #052e16;
  border-color: #166534;
}
.non-show-checkbox-label {
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 600;
  cursor: pointer;
  font-size: 14px;
  margin-bottom: 0;
  color: #166534;
}
body.dark .non-show-checkbox-label {
  color: #86efac;
}
.non-show-checkbox-label input[type="checkbox"] {
  width: 20px;
  height: 20px;
  cursor: pointer;
  margin: 0;
  accent-color: #22c55e;
}
.non-show-info {
  margin-top: 10px;
  padding: 8px 10px;
  background: #dcfce7;
  border-radius: 8px;
  font-size: 12px;
  color: #166534;
  display: flex;
  align-items: center;
  gap: 5px;
}
body.dark .non-show-info {
  background: #14532d;
  color: #86efac;
}
.non-show-info.show {
  display: flex !important;
}

/* Birthday Show CSS */
.birthday-section {
  margin: 15px 0;
  padding: 15px;
  background: #fff5f5;
  border-radius: 12px;
  border: 2px solid #fecaca;
}
body.dark .birthday-section {
  background: #1f1818;
  border-color: #7f1d1d;
}
.birthday-checkbox-label {
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 600;
  cursor: pointer;
  font-size: 14px;
  margin-bottom: 0;
}
.birthday-checkbox-label input[type="checkbox"] {
  width: 20px;
  height: 20px;
  cursor: pointer;
  margin: 0;
}
.birthday-dropdown {
  margin-top: 15px;
  padding-top: 15px;
  border-top: 1px solid #fecaca;
  display: none;
}
body.dark .birthday-dropdown {
  border-top-color: #7f1d1d;
}
.birthday-dropdown.show {
  display: block;
}
.birthday-dropdown .input-label {
  margin-bottom: 6px;
  display: block;
}

/* Graduation Show CSS */
.graduation-section {
  margin: 15px 0;
  padding: 15px;
  background: #eff6ff;
  border-radius: 12px;
  border: 2px solid #bfdbfe;
}
body.dark .graduation-section {
  background: #1a1f2e;
  border-color: #1e3a8a;
}
.graduation-checkbox-label {
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 600;
  cursor: pointer;
  font-size: 14px;
  margin-bottom: 0;
}
.graduation-checkbox-label input[type="checkbox"] {
  width: 20px;
  height: 20px;
  cursor: pointer;
  margin: 0;
}
.graduation-dropdown {
  margin-top: 15px;
  padding-top: 15px;
  border-top: 1px solid #bfdbfe;
  display: none;
}
body.dark .graduation-dropdown {
  border-top-color: #1e3a8a;
}
.graduation-dropdown.show {
  display: block;
}
.graduation-dropdown .input-label {
  margin-bottom: 6px;
  display: block;
}

/* Card untuk graduated member */
.card.graduated {
  border: 2px solid #6b7280;
  opacity: 0.6;
  position: relative;
}
.card.graduated::after {
  content: "GRADUATED";
  position: absolute;
  top: 38%;
  left: 50%;
  transform: translate(-50%, -50%) rotate(-25deg);
  background: rgba(30,30,40,0.82);
  color: #e5e7eb;
  font-size: 11px;
  font-weight: 800;
  padding: 6px 14px;
  border-radius: 8px;
  z-index: 20;
  letter-spacing: 2px;
  border: 1px solid rgba(255,255,255,0.15);
  backdrop-filter: blur(4px);
}
.card.graduated .admin-controls button {
  opacity: 0.25;
  cursor: not-allowed;
}

/* Bulk Add Modal khusus */
#bulkAddModal .modal-box {
  max-width: 460px;
  max-height: 88vh;
  padding: 24px 24px 0 24px;
  display: flex;
  flex-direction: column;
}
#bulkAddModal .modal-body {
  flex: 1;
  overflow-y: auto;
  padding-bottom: 8px;
}
#bulkAddModal .modal-header-block h3 {
  font-size: 18px;
  font-weight: 700;
  margin: 0 0 4px;
}
#bulkAddModal .modal-header-block p {
  font-size: 13px;
  color: #6b7280;
  margin: 0 0 16px;
}
#bulkAddModal .form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-bottom: 4px;
}
#bulkAddModal .modal-divider {
  height: 1px;
  background: #e5e7eb;
  margin: 14px 0;
}
body.dark #bulkAddModal .modal-divider { background: #1f2937; }
#bulkAddModal .options-grid {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-bottom: 14px;
}
#bulkAddModal .option-card {
  padding: 12px 14px;
  border-radius: 12px;
  border: 1.5px solid;
  transition: all 0.2s;
}
#bulkAddModal .option-card-row {
  display: flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
}
#bulkAddModal .option-card.birthday-card { background:#fff5f5;border-color:#fecaca; }
#bulkAddModal .option-card.graduation-card { background:#eff6ff;border-color:#bfdbfe; }
#bulkAddModal .option-card.nonshow-card { background:#f0fdf4;border-color:#86efac; }
body.dark #bulkAddModal .option-card.birthday-card { background:#1f1818;border-color:#7f1d1d; }
body.dark #bulkAddModal .option-card.graduation-card { background:#1a1f2e;border-color:#1e3a8a; }
body.dark #bulkAddModal .option-card.nonshow-card { background:#052e16;border-color:#166534; }
#bulkAddModal .option-card input[type="checkbox"] {
  width:18px;height:18px;cursor:pointer;margin:0;flex-shrink:0;
  accent-color:#e60012;
}
#bulkAddModal .option-label { font-size:13px;font-weight:600;flex:1; }
#bulkAddModal .option-card.birthday-card .option-label { color:#be123c; }
#bulkAddModal .option-card.graduation-card .option-label { color:#1e40af; }
#bulkAddModal .option-card.nonshow-card .option-label { color:#166534; }
body.dark #bulkAddModal .option-card.birthday-card .option-label { color:#fca5a5; }
body.dark #bulkAddModal .option-card.graduation-card .option-label { color:#93c5fd; }
body.dark #bulkAddModal .option-card.nonshow-card .option-label { color:#86efac; }
#bulkAddModal .option-dropdown {
  margin-top: 10px;
  padding-top: 10px;
  border-top: 1px solid rgba(0,0,0,0.08);
  display: none;
}
body.dark #bulkAddModal .option-dropdown { border-top-color: rgba(255,255,255,0.06); }
#bulkAddModal .option-dropdown.show { display: block; }
#bulkAddModal .option-dropdown select {
  width:100%;padding:10px 12px;border-radius:10px;border:1.5px solid #ddd;
  background:#fff;color:#333;font-size:13px;outline:none;margin:0;
}
body.dark #bulkAddModal .option-dropdown select { background:#0a0e1a;color:#e5e7eb;border-color:#374151; }
#bulkAddModal .option-warning {
  font-size:11px;padding:7px 10px;border-radius:8px;margin-top:8px;line-height:1.4;
}
#bulkAddModal .member-textarea {
  width:100%;min-height:80px;max-height:110px;resize:vertical;
  padding:10px 12px;border-radius:12px;border:1.5px solid #ddd;
  background:#fff;color:#333;font-size:13px;font-family:Arial,sans-serif;
  outline:none;transition:border-color 0.2s;display:block;
}
#bulkAddModal .member-textarea:focus { border-color:#e60012; }
body.dark #bulkAddModal .member-textarea { background:#0a0e1a;color:#e5e7eb;border-color:#374151; }
#bulkAddModal .modal-footer {
  position: sticky;
  bottom: 0;
  background: #fff;
  padding: 12px 0 20px;
  display: flex;
  gap: 10px;
  border-top: 1px solid #e5e7eb;
  margin-top: 6px;
}
body.dark #bulkAddModal .modal-footer { background:#111827;border-top-color:#1f2937; }
#bulkAddModal .modal-footer .btn-cancel {
  flex:1;padding:12px;font-size:14px;border-radius:12px;
  background:#f3f4f6;color:#374151;font-weight:600;
}
body.dark #bulkAddModal .modal-footer .btn-cancel { background:#374151;color:#e5e7eb; }
#bulkAddModal .modal-footer .btn-add {
  flex:2;padding:12px;font-size:14px;border-radius:12px;
  background:#22c55e;color:#fff;font-weight:700;
}

/* Logout button with icon */
.logout-btn {
  display: flex !important;
  align-items: center;
  gap: 6px;
  background: #ef4444 !important;
  color: #fff !important;
  padding: 9px 16px !important;
  border-radius: 20px;
  font-size: 13px !important;
  font-weight: bold;
  white-space: nowrap;
}
.logout-btn svg { width:15px;height:15px;flex-shrink:0; }
.bulk-btn { padding: 9px 16px !important; font-size: 13px !important; }

/* Edit Show Button */
.event-actions {
  display: flex;
  gap: 4px;
  margin-left: 8px;
}

.event-edit-btn {
  background: #3b82f6;
  color: white;
  border: none;
  border-radius: 4px;
  width: 24px;
  height: 24px;
  font-size: 12px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
}

.event-edit-btn:hover {
  background: #2563eb;
}

/* Edit Show Modal */
#editShowModal .modal-box {
  max-width: 400px;
}

/* Custom Setlist Field */
.custom-setlist-field {
    margin-top: 10px;
    display: none;
}
.custom-setlist-field.show {
    display: block;
}

/* ===== RESPONSIVE BREAKPOINTS ===== */

/* Mobile kecil (max 480px) */
@media (max-width:480px) {
  header{padding:10px 14px;min-height:52px}
  .header-title{font-size:15px}
  .admin-badge{font-size:10px;padding:3px 8px}
  .header-theme-toggle{width:34px;height:34px;padding:7px}
  .header-theme-toggle svg{width:18px;height:18px}
  .top{padding:10px 12px;gap:8px}
  .search-box{min-width:0;flex:1}
  .logout-btn,.bulk-btn{padding:9px 14px;font-size:13px}
  .activity-section{padding:12px 14px}
  .activity-title{font-size:14px}
  .activity-log{max-height:160px;padding:10px}
  .filters{padding:10px 12px;gap:6px}
  .filter{font-size:11px;padding:6px 10px}
  .stats{font-size:11px;padding:6px 12px}
  .name{font-size:11px}
  .show{font-size:9px}
  .show-num{font-size:13px}
  .gen-badge{font-size:7px;padding:2px 6px}
  .admin-controls button{width:26px;height:26px;min-width:26px;min-height:26px;font-size:14px;border-radius:8px}
  .card-footer{padding:8px 6px}
  .modal-box{padding:20px 16px}
  .modal-box h3{font-size:17px}
  #bulkAddModal .modal-box{max-width:100%;margin:0;border-radius:16px 16px 0 0}
}

/* Mobile standar (481px - 767px) */
@media (min-width:481px) and (max-width:767px) {
  header{padding:12px 16px;min-height:55px}
  .header-title{font-size:16px}
  .top{padding:11px 16px}
  .logout-btn,.bulk-btn{padding:9px 16px;font-size:13px}
  .activity-section{padding:12px 16px}
  .filters{padding:12px 14px;gap:7px}
  .filter{font-size:12px;padding:7px 12px}
}

/* Tablet (768px - 1023px) */
@media (min-width:768px) and (max-width:1023px) {
  header{padding:14px 20px}
  .top{padding:12px 20px}
  .activity-section{padding:14px 20px}
  .activity-log{max-height:180px}
  .filters{padding:12px 18px}
  .filter{font-size:12px;padding:8px 14px}
  .name{font-size:11px}
  .show{font-size:10px}
  .admin-controls button{width:26px;height:26px;min-width:26px;min-height:26px;font-size:16px}
}

/* Desktop (1024px+) */
@media (min-width:1024px) {
  .top{padding:14px 24px}
  .search-box{max-width:500px}
  .activity-section{padding:16px 24px}
  .filters{padding:14px 24px;gap:10px}
  .filter{font-size:13px;padding:9px 18px}
  .name{font-size:12px}
  .show{font-size:10px}
  .gen-badge{font-size:8px}
  .card-footer{padding:9px 7px}
}

/* Lebar penuh (1280px+) */
@media (min-width:1280px) {
  .activity-section{padding:16px 32px}
  .filters{padding:14px 32px}
  .stats{padding:8px 32px}
  .name{font-size:13px}
  .show{font-size:11px}
  .gen-badge{font-size:9px;padding:3px 8px}
}

/* Top bar responsif untuk small screens */
@media (max-width:540px) {
  .top{flex-wrap:wrap;padding:12px 14px;gap:10px}
  .search-box{max-width:100%;width:100%}
  .top-actions{width:100%;justify-content:flex-end}
  .logout-btn,.bulk-btn{flex:1;text-align:center;padding:9px 12px;font-size:13px}
}

/* ===== END RESPONSIVE ===== */

/* ===== SETLIST MODAL â€” IDENTIK DENGAN BULK ADD ===== */
#setlistModal .modal-box { max-width:460px; max-height:88vh; padding:24px 24px 0 24px; display:flex; flex-direction:column; }
#setlistModal .modal-body { flex:1; overflow-y:auto; padding-bottom:8px; }
#setlistModal .modal-header-block h3 { font-size:18px; font-weight:700; margin:0 0 4px; display:flex; align-items:center; gap:8px; }
#setlistModal .modal-header-block p { font-size:13px; color:#6b7280; margin:0 0 16px; }
body.dark #setlistModal .modal-header-block p { color:#9ca3af; }
#setlistModal .form-row { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:4px; }
#setlistModal .modal-divider { height:1px; background:#e5e7eb; margin:14px 0; }
body.dark #setlistModal .modal-divider { background:#1f2937; }
#setlistModal .options-grid { display:flex; flex-direction:column; gap:8px; margin-bottom:14px; }
#setlistModal .option-card { padding:12px 14px; border-radius:12px; border:1.5px solid; transition:all 0.2s; }
#setlistModal .option-card-row { display:flex; align-items:center; gap:10px; cursor:pointer; }
#setlistModal .option-card.birthday-card   { background:#fff5f5; border-color:#fecaca; }
#setlistModal .option-card.graduation-card { background:#eff6ff; border-color:#bfdbfe; }
#setlistModal .option-card.nonshow-card    { background:#f0fdf4; border-color:#86efac; }
body.dark #setlistModal .option-card.birthday-card   { background:#1f1818; border-color:#7f1d1d; }
body.dark #setlistModal .option-card.graduation-card { background:#1a1f2e; border-color:#1e3a8a; }
body.dark #setlistModal .option-card.nonshow-card    { background:#052e16; border-color:#166534; }
#setlistModal .option-card input[type="checkbox"] { width:18px; height:18px; cursor:pointer; margin:0; flex-shrink:0; accent-color:#e60012; }
#setlistModal .option-label { font-size:13px; font-weight:600; flex:1; display:flex; align-items:center; gap:7px; }
#setlistModal .option-card.birthday-card   .option-label { color:#be123c; }
#setlistModal .option-card.graduation-card .option-label { color:#1e40af; }
#setlistModal .option-card.nonshow-card    .option-label { color:#166534; }
body.dark #setlistModal .option-card.birthday-card   .option-label { color:#fca5a5; }
body.dark #setlistModal .option-card.graduation-card .option-label { color:#93c5fd; }
body.dark #setlistModal .option-card.nonshow-card    .option-label { color:#86efac; }
#setlistModal .option-dropdown { margin-top:10px; padding-top:10px; border-top:1px solid rgba(0,0,0,0.08); display:none; }
body.dark #setlistModal .option-dropdown { border-top-color:rgba(255,255,255,0.06); }
#setlistModal .option-dropdown.show { display:block; }
#setlistModal .option-dropdown select { width:100%; padding:10px 12px; border-radius:10px; border:1.5px solid #ddd; background:#fff; color:#333; font-size:13px; outline:none; margin:0; }
body.dark #setlistModal .option-dropdown select { background:#0a0e1a; color:#e5e7eb; border-color:#374151; }
#setlistModal .option-warning { font-size:11px; padding:7px 10px; border-radius:8px; margin-top:8px; line-height:1.4; }
#setlistModal .modal-footer { position:sticky; bottom:0; background:#fff; padding:12px 0 20px; display:flex; gap:10px; border-top:1px solid #e5e7eb; margin-top:6px; }
body.dark #setlistModal .modal-footer { background:#111827; border-top-color:#1f2937; }
#setlistModal .modal-footer .btn-cancel { flex:1; padding:12px; font-size:14px; border-radius:12px; background:#f3f4f6; color:#374151; font-weight:600; }
body.dark #setlistModal .modal-footer .btn-cancel { background:#374151; color:#e5e7eb; }
#setlistModal .modal-footer .btn-add { flex:2; padding:12px; font-size:14px; border-radius:12px; background:#22c55e; color:#fff; font-weight:700; }
#setlistModal #setlistMemberNameInput {
  width:100%; padding:10px 12px; border-radius:12px; border:1.5px solid #ddd;
  background:#fff; color:#333; font-size:13px; outline:none; transition:border-color 0.2s; display:block; margin-bottom:0;
}
#setlistModal #setlistMemberNameInput:focus { border-color:#e60012; }
body.dark #setlistModal #setlistMemberNameInput { background:#0a0e1a; color:#e5e7eb; border-color:#374151; }

/* ===== LOGIN SPLASH ANIMATION ===== */
#loginSplash {
  position: fixed;
  inset: 0;
  background: #e60012;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  overflow: hidden;
}
#loginSplash .splash-rings {
  position: absolute;
  inset: 0;
  pointer-events: none;
}
#loginSplash .ring {
  position: absolute;
  border-radius: 50%;
  border: 2px solid rgba(255,255,255,0.15);
  animation: ringExpand 3s ease-out infinite;
}
#loginSplash .ring:nth-child(1) { width:200px;height:200px;top:50%;left:50%;transform:translate(-50%,-50%);animation-delay:0s; }
#loginSplash .ring:nth-child(2) { width:300px;height:300px;top:50%;left:50%;transform:translate(-50%,-50%);animation-delay:0.5s; }
#loginSplash .ring:nth-child(3) { width:420px;height:420px;top:50%;left:50%;transform:translate(-50%,-50%);animation-delay:1s; }
#loginSplash .ring:nth-child(4) { width:560px;height:560px;top:50%;left:50%;transform:translate(-50%,-50%);animation-delay:1.5s; }
@keyframes ringExpand {
  0% { opacity:0.7; transform:translate(-50%,-50%) scale(0.8); }
  100% { opacity:0; transform:translate(-50%,-50%) scale(1.4); }
}
.splash-logo {
  animation: splashPop 0.6s cubic-bezier(0.34,1.56,0.64,1) 0.2s both;
  text-align: center;
  z-index: 2;
}
@keyframes splashPop {
  0% { opacity:0; transform:scale(0.5); }
  100% { opacity:1; transform:scale(1); }
}
.splash-logo .logo-icon {
  width:80px;height:80px;margin:0 auto 16px;
  background:rgba(255,255,255,0.2);
  border-radius:24px;display:flex;align-items:center;justify-content:center;
  backdrop-filter:blur(10px);
  box-shadow:0 8px 32px rgba(0,0,0,0.2);
}
.splash-logo .logo-icon svg { width:44px;height:44px;color:#fff; }
.splash-title {
  font-size:28px;font-weight:900;color:#fff;letter-spacing:1px;
  text-shadow:0 2px 8px rgba(0,0,0,0.2);
  animation: splashSlideUp 0.5s ease 0.5s both;
}
.splash-sub {
  font-size:13px;color:rgba(255,255,255,0.8);margin-top:6px;letter-spacing:3px;
  text-transform:uppercase;
  animation: splashSlideUp 0.5s ease 0.7s both;
}
@keyframes splashSlideUp {
  from { opacity:0; transform:translateY(16px); }
  to { opacity:1; transform:translateY(0); }
}
.splash-dots {
  position:absolute;bottom:60px;
  display:flex;gap:8px;
  animation: splashSlideUp 0.4s ease 0.9s both;
}
.splash-dot {
  width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,0.4);
  animation: dotPulse 1.2s ease-in-out infinite;
}
.splash-dot:nth-child(2) { animation-delay:0.2s; }
.splash-dot:nth-child(3) { animation-delay:0.4s; }
@keyframes dotPulse {
  0%,100% { transform:scale(1);background:rgba(255,255,255,0.4); }
  50% { transform:scale(1.4);background:rgba(255,255,255,0.9); }
}
#loginSplash.hiding {
  animation: splashHide 0.5s cubic-bezier(0.55,0,1,0.45) forwards;
}
@keyframes splashHide {
  0% { opacity:1; transform:scale(1); }
  100% { opacity:0; transform:scale(1.08); }
}
@keyframes loginBoxIn {
  from { opacity:0; transform:translateY(30px) scale(0.95); }
  to { opacity:1; transform:translateY(0) scale(1); }
}

/* ===== DESKTOP LOGIN TWO-PANEL ===== */
#loginModal {
  display: none;
  position: fixed;
  inset: 0;
  background: none;
  align-items: stretch;
  justify-content: stretch;
  z-index: 999;
  padding: 0;
}

/* Override default modal-box inside loginModal */
#loginModal .modal-box { display: none !important; }

.login-desktop-card {
  display: flex;
  width: 100%;
  height: 100%;
  max-width: 100%;
  border-radius: 0;
  overflow: hidden;
  box-shadow: none;
  animation: none;
  position: relative;
  flex: 1;
}
#loginModal.animate-in .login-desktop-card {
  animation: loginBoxIn 0.45s cubic-bezier(0.34,1.56,0.64,1) both;
}

/* LEFT PANEL */
.login-left-panel {
  flex: 1.2;
  background: linear-gradient(145deg, #a8000c 0%, #c8000f 30%, #e60012 60%, #ff2030 100%);
  padding: 52px 60px;
  display: flex;
  flex-direction: column;
  position: relative;
  overflow: hidden;
  justify-content: space-between;
}
.login-left-inner { position: relative; z-index: 2; flex: 1; display: flex; flex-direction: column; justify-content: space-between; }

.login-brand {
  display: flex;
  align-items: center;
  gap: 14px;
  margin-bottom: 0;
}
.login-brand-icon {
  width: 52px;
  height: 52px;
  background: rgba(255,255,255,0.18);
  border-radius: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(8px);
  flex-shrink: 0;
  box-shadow: 0 4px 16px rgba(0,0,0,0.15);
}
.login-brand-name {
  font-size: 22px;
  font-weight: 900;
  color: #fff;
  letter-spacing: 1px;
  line-height: 1.1;
}
.login-brand-sub {
  font-size: 11px;
  color: rgba(255,255,255,0.75);
  letter-spacing: 1.5px;
  text-transform: uppercase;
  margin-top: 2px;
}

/* Center hero block */
.login-hero-block {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 0;
  padding: 20px 0;
  flex: 1;
  justify-content: center;
}
.login-hero-icon-wrap {
  width: 96px;
  height: 96px;
  background: rgba(255,255,255,0.15);
  border-radius: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 28px;
  backdrop-filter: blur(10px);
  box-shadow: 0 8px 32px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.2);
  border: 1px solid rgba(255,255,255,0.2);
}
.login-tagline {
  font-size: 42px;
  font-weight: 900;
  color: #fff;
  line-height: 1.15;
  margin-bottom: 16px;
  letter-spacing: -1px;
}
.login-tagline span {
  background: rgba(255,255,255,0.22);
  padding: 2px 12px;
  border-radius: 8px;
  display: inline-block;
}
.login-tagline-sub {
  font-size: 15px;
  color: rgba(255,255,255,0.75);
  line-height: 1.6;
  margin-bottom: 36px;
  max-width: 420px;
}

.login-features {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-bottom: 0;
}
.login-feature-item {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  background: rgba(255,255,255,0.1);
  border-radius: 14px;
  padding: 14px 16px;
  border: 1px solid rgba(255,255,255,0.12);
  backdrop-filter: blur(6px);
  transition: background 0.2s;
}
.login-feature-item:hover { background: rgba(255,255,255,0.16); }
.login-feature-icon {
  width: 36px;
  height: 36px;
  background: rgba(255,255,255,0.2);
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  flex-shrink: 0;
}
.login-feature-title {
  font-size: 13px;
  font-weight: 700;
  color: #fff;
  margin-bottom: 3px;
}
.login-feature-desc {
  font-size: 11px;
  color: rgba(255,255,255,0.68);
  line-height: 1.4;
}

.login-stats-strip {
  display: flex;
  align-items: center;
  gap: 0;
  background: rgba(0,0,0,0.2);
  border-radius: 16px;
  padding: 16px 20px;
  border: 1px solid rgba(255,255,255,0.1);
  margin-top: 28px;
}
.login-stat { flex: 1; text-align: center; }
.login-stat-num {
  font-size: 20px;
  font-weight: 900;
  color: #fff;
  line-height: 1;
  margin-bottom: 4px;
}
.login-stat-label {
  font-size: 10px;
  color: rgba(255,255,255,0.65);
  letter-spacing: 0.5px;
  text-transform: uppercase;
}
.login-stat-divider {
  width: 1px;
  height: 36px;
  background: rgba(255,255,255,0.2);
  flex-shrink: 0;
}

/* Decorative elements */
.login-deco-circle {
  position: absolute;
  border-radius: 50%;
  background: rgba(255,255,255,0.06);
  z-index: 1;
}
.login-deco-1 {
  width: 500px;
  height: 500px;
  top: -180px;
  right: -160px;
  background: rgba(255,255,255,0.05);
}
.login-deco-2 {
  width: 300px;
  height: 300px;
  bottom: -100px;
  left: -80px;
  background: rgba(0,0,0,0.08);
}
.login-deco-3 {
  width: 180px;
  height: 180px;
  top: 50%;
  right: -50px;
  transform: translateY(-50%);
  background: rgba(255,255,255,0.04);
  border: 2px solid rgba(255,255,255,0.08);
}
.login-deco-4 {
  width: 80px;
  height: 80px;
  top: 30%;
  left: 20px;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.1);
}
/* Animated dot grid */
.login-dot-grid {
  position: absolute;
  bottom: 60px;
  right: 40px;
  z-index: 1;
  display: grid;
  grid-template-columns: repeat(6, 10px);
  gap: 8px;
  opacity: 0.18;
}
.login-dot-grid span {
  width: 4px;
  height: 4px;
  background: #fff;
  border-radius: 50%;
  display: block;
}

/* RIGHT PANEL */
.login-right-panel {
  flex: 0.8;
  background: #fff;
  padding: 60px 56px;
  display: flex;
  flex-direction: column;
  position: relative;
  justify-content: center;
}
body.dark .login-right-panel {
  background: #111827;
}

.login-theme-btn {
  position: absolute;
  top: 18px;
  right: 18px;
  background: #f3f4f6;
  border: none;
  color: #374151;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 7px;
  transition: all 0.2s;
}
body.dark .login-theme-btn {
  background: #1f2937;
  color: #e5e7eb;
}
.login-theme-btn:hover { transform: scale(1.1); }

.login-form-wrap {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  max-width: 400px;
  width: 100%;
  margin: 0 auto;
}

.login-form-icon {
  width: 52px;
  height: 52px;
  background: #e60012;
  border-radius: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 20px;
}
.login-form-title {
  font-size: 22px;
  font-weight: 800;
  color: #111;
  margin: 0 0 6px;
}
body.dark .login-form-title { color: #f9fafb; }
.login-form-sub {
  font-size: 13px;
  color: #6b7280;
  margin: 0 0 28px;
}
body.dark .login-form-sub { color: #9ca3af; }

/* Override input styles in login form */
.login-right-panel .input-label {
  display: block;
  font-size: 12px;
  font-weight: 600;
  color: #374151;
  margin-bottom: 6px;
  margin-top: 14px;
}
body.dark .login-right-panel .input-label { color: #d1d5db; }
.login-right-panel input {
  width: 100%;
  padding: 12px 16px;
  border-radius: 10px;
  border: 2px solid #e5e7eb;
  background: #f9fafb;
  font-size: 14px;
  outline: none;
  color: #111;
  transition: border-color 0.2s, background 0.2s;
  margin: 0;
}
.login-right-panel input:focus {
  border-color: #e60012;
  background: #fff;
}
body.dark .login-right-panel input {
  background: #0a0e1a;
  border-color: #374151;
  color: #e5e7eb;
}
body.dark .login-right-panel input:focus {
  border-color: #f87171;
  background: #111827;
}

.login-submit-btn {
  width: 100%;
  margin-top: 22px;
  background: #e60012;
  color: #fff;
  padding: 13px;
  border-radius: 12px;
  font-size: 15px;
  font-weight: 700;
  letter-spacing: 0.3px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  transition: background 0.2s, transform 0.1s, box-shadow 0.2s;
  box-shadow: 0 4px 16px rgba(230,0,18,0.3);
}
.login-submit-btn:hover {
  background: #c8000f;
  box-shadow: 0 6px 20px rgba(230,0,18,0.4);
  transform: translateY(-1px);
}
.login-submit-btn:active { transform: scale(0.98); }

.login-footer-note {
  text-align: center;
  font-size: 11px;
  color: #9ca3af;
  margin-top: 24px;
}

/* MOBILE: collapse to single-panel fullscreen */
@media (max-width: 700px) {
  .login-desktop-card {
    flex-direction: column;
    height: 100vh;
    border-radius: 0;
  }
  .login-left-panel {
    padding: 28px 24px 20px;
    flex: 0 0 auto;
    justify-content: flex-start;
  }
  .login-right-panel {
    flex: 1;
    max-width: 100%;
    padding: 28px 24px;
    justify-content: center;
  }
  .login-hero-block { padding: 12px 0; gap: 0; }
  .login-hero-icon-wrap { display: none; }
  .login-tagline { font-size: 22px; margin-bottom: 8px; }
  .login-tagline-sub { display: none; }
  .login-features { display: none; }
  .login-stats-strip { padding: 10px 14px; margin-top: 14px; }
  .login-stat-num { font-size: 14px; }
  .login-brand { margin-bottom: 0; }
  .login-form-title { font-size: 20px; }
  .login-form-sub { margin-bottom: 16px; }
  .login-dot-grid { display: none; }
}

@media (min-width: 701px) and (max-width: 1024px) {
  .login-left-panel { padding: 40px 36px; }
  .login-tagline { font-size: 30px; }
  .login-tagline-sub { font-size: 13px; }
  .login-right-panel { padding: 40px 36px; }
  .login-hero-icon-wrap { width: 72px; height: 72px; }
}
/* ===== END DESKTOP LOGIN ===== */
</style>
</head>
<body>

<!-- Login Splash Animation -->
<div id="loginSplash">
  <div class="splash-rings">
    <div class="ring"></div>
    <div class="ring"></div>
    <div class="ring"></div>
    <div class="ring"></div>
  </div>
  <div class="splash-logo">
    <div class="logo-icon">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
        <circle cx="9" cy="7" r="4"/>
        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
      </svg>
    </div>
    <div class="splash-title">JKT48</div>
    <div class="splash-sub">Show Theater Admin</div>
  </div>
  <div class="splash-dots">
    <div class="splash-dot"></div>
    <div class="splash-dot"></div>
    <div class="splash-dot"></div>
  </div>
</div>

<header>
  <div class="header-left">
    <span class="header-title">JKT48 SHOW THEATER</span>
    <span class="admin-badge">ADMIN</span>
  </div>
  <div style="display:flex;align-items:center;gap:8px;">
    <button class="header-theme-toggle" onclick="toggleTheme()">
      <svg id="themeIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"/></svg>
    </button>
    <button class="header-logout-btn" onclick="logout()" title="Logout">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
        <polyline points="16 17 21 12 16 7"/>
        <line x1="21" y1="12" x2="9" y2="12"/>
      </svg>
    </button>
  </div>
</header>

<div class="top">
    <div class="search-box">
        <!-- Search icon (kaca pembesar) -->
        <span class="search-icon" id="searchIconSpan">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"/>
                <line x1="21" y1="21" x2="16.65" y2="16.65"/>
            </svg>
        </span>
        <input type="text" id="searchInput" placeholder="Cari member..." oninput="searchMember(); toggleClearBtn()">
        <button class="search-clear-btn" id="searchClear" onclick="clearSearch()" title="Hapus pencarian">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round">
                <path d="M18 6L6 18M6 6l12 12"/>
            </svg>
        </button>
    </div>
    <div class="top-actions">
        <button class="bulk-btn" onclick="openBulkAddModal()">Bulk Add</button>
    </div>
</div>

<div class="activity-section"><div class="activity-header"><div class="activity-title">Activity Log</div><button class="clear-log-btn" onclick="clearActivityLog()">Clear</button></div><div class="activity-log" id="activityLog"><div class="activity-empty">Belum ada aktivitas hari ini</div></div></div>
<div class="filters">
    <button class="filter all active" onclick="filterType('all')">ALL</button>
    <button class="filter inti" onclick="filterType('inti')">INTI</button>
    <button class="filter trainee" onclick="filterType('trainee')">TRAINEE</button>
    <button class="filter" onclick="filterGen(3)" style="background:#ec4899;color:#fff">Gen 3</button>
    <button class="filter" onclick="filterGen(6)" style="background:#22c55e;color:#fff">Gen 6</button>
    <button class="filter" onclick="filterGen(7)" style="background:#15803d;color:#fff">Gen 7</button>
    <button class="filter" onclick="filterGen(8)" style="background:#1e40af;color:#fff">Gen 8</button>
    <button class="filter" onclick="filterGen(9)" style="background:#06b6d4;color:#fff">Gen 9</button>
    <button class="filter" onclick="filterGen(10)" style="background:#38bdf8;color:#fff">Gen 10</button>
    <button class="filter" onclick="filterGen(11)" style="background:#f97316;color:#fff">Gen 11</button>
    <button class="filter" onclick="filterGen(12)" style="background:#fde68a;color:#000">Gen 12</button>
    <button class="filter" onclick="filterGen(13)" style="background:#facc15;color:#000">Gen 13</button>
    <button class="filter" onclick="filterGen(14)" style="background:#e879f9;color:#fff">Gen 14</button>
</div>
<div class="stats" id="stats"></div>
<div class="container" id="list"><div class="loading"><div class="spinner"></div><span>Loading data...</span></div></div>

<!-- Notification Container -->
<div class="notification" id="notificationContainer"></div>

<!-- Login Modal -->
<div class="modal" id="loginModal">
  <!-- Desktop: two-panel card -->
  <div class="login-desktop-card">

    <!-- LEFT: Info Panel -->
    <div class="login-left-panel">
      <div class="login-left-inner">

        <!-- Top: Brand -->
        <div class="login-brand">
          <div class="login-brand-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
          </div>
          <div>
            <div class="login-brand-name">JKT48</div>
            <div class="login-brand-sub">Show Theater Admin</div>
          </div>
        </div>

        <!-- Hero block -->
        <div class="login-hero-block">
          <!-- Big icon -->
          <div class="login-hero-icon-wrap">
            <svg xmlns="http://www.w3.org/2000/svg" width="52" height="52" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
              <line x1="16" y1="2" x2="16" y2="6"/>
              <line x1="8" y1="2" x2="8" y2="6"/>
              <line x1="3" y1="10" x2="21" y2="10"/>
              <line x1="9" y1="15" x2="13" y2="15"/>
              <line x1="9" y1="19" x2="15" y2="19"/>
            </svg>
          </div>

          <!-- Tagline -->
          <div class="login-tagline">
            Manajemen<br>Show &amp; Member<br><span>JKT48 Theater</span>
          </div>
          <div class="login-tagline-sub">
            Platform admin terpusat untuk mengelola data show, member, setlist, dan aktivitas theater JKT48 secara real-time.
          </div>

          <!-- Feature grid 2 kolom -->
          <div class="login-features">
            <div class="login-feature-item">
              <div class="login-feature-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
              </div>
              <div>
                <div class="login-feature-title">Kelola Show</div>
                <div class="login-feature-desc">Tambah, edit &amp; hapus data show per member</div>
              </div>
            </div>
            <div class="login-feature-item">
              <div class="login-feature-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1"/><line x1="9" y1="12" x2="15" y2="12"/><line x1="9" y1="16" x2="13" y2="16"/></svg>
              </div>
              <div>
                <div class="login-feature-title">Bulk Add</div>
                <div class="login-feature-desc">Input banyak member dalam satu operasi</div>
              </div>
            </div>
            <div class="login-feature-item">
              <div class="login-feature-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
              </div>
              <div>
                <div class="login-feature-title">Activity Log</div>
                <div class="login-feature-desc">Pantau semua perubahan secara real-time</div>
              </div>
            </div>
            <div class="login-feature-item">
              <div class="login-feature-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>
              </div>
              <div>
                <div class="login-feature-title">Birthday &amp; Graduation</div>
                <div class="login-feature-desc">Tandai show spesial member</div>
              </div>
            </div>
            <div class="login-feature-item">
              <div class="login-feature-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
              </div>
              <div>
                <div class="login-feature-title">Filter &amp; Cari</div>
                <div class="login-feature-desc">Cari member berdasarkan gen &amp; status</div>
              </div>
            </div>
            <div class="login-feature-item">
              <div class="login-feature-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>
              </div>
              <div>
                <div class="login-feature-title">Supabase DB</div>
                <div class="login-feature-desc">Data tersimpan aman &amp; terenkripsi</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Stats strip -->
        <div class="login-stats-strip">
          <div class="login-stat">
            <div class="login-stat-num" id="loginStatMembers">â€”</div>
            <div class="login-stat-label">Member Aktif</div>
          </div>
          <div class="login-stat-divider"></div>
          <div class="login-stat">
            <div class="login-stat-num" id="loginStatGen">14</div>
            <div class="login-stat-label">Generasi</div>
          </div>
          <div class="login-stat-divider"></div>
          <div class="login-stat">
            <div class="login-stat-num">Real-time</div>
            <div class="login-stat-label">Supabase DB</div>
          </div>
        </div>

      </div>

      <!-- Decorative elements -->
      <div class="login-deco-circle login-deco-1"></div>
      <div class="login-deco-circle login-deco-2"></div>
      <div class="login-deco-circle login-deco-3"></div>
      <div class="login-deco-circle login-deco-4"></div>
      <!-- Dot grid -->
      <div class="login-dot-grid">
        <span></span><span></span><span></span><span></span><span></span><span></span>
        <span></span><span></span><span></span><span></span><span></span><span></span>
        <span></span><span></span><span></span><span></span><span></span><span></span>
        <span></span><span></span><span></span><span></span><span></span><span></span>
        <span></span><span></span><span></span><span></span><span></span><span></span>
        <span></span><span></span><span></span><span></span><span></span><span></span>
      </div>
    </div>

    <!-- RIGHT: Login Form -->
    <div class="login-right-panel">

      <div class="login-form-wrap">
        <div class="login-form-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
        </div>
        <h3 class="login-form-title">Selamat Datang</h3>
        <p class="login-form-sub">Masukkan kredensial admin untuk melanjutkan</p>

        <label class="input-label">Email</label>
        <input id="email" type="email" placeholder="Masukan email">
        <label class="input-label">Password</label>
        <input id="password" type="password" placeholder="Masukkan password" onkeypress="if(event.key==='Enter')login()">
        <div class="error" id="errorMsg"></div>
        <button onclick="login()" class="login-submit-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
          Masuk
        </button>

        <div class="login-footer-note">Â© 2026 JKT48 Show Theater. Admin only.</div>
      </div>
    </div>

  </div>
</div>

<!-- Logout Modal -->
<div class="modal" id="logoutModal">
  <div class="modal-box" style="text-align:center;max-width:340px;">
    <div style="width:64px;height:64px;background:#fee2e2;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 16px;">
      <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
        <polyline points="16 17 21 12 16 7"/>
        <line x1="21" y1="12" x2="9" y2="12"/>
      </svg>
    </div>
    <h3 style="font-size:18px;font-weight:700;margin-bottom:8px;">Keluar dari Admin Panel?</h3>
    <p style="font-size:13px;color:#6b7280;line-height:1.6;margin-bottom:24px;">Sesi kamu akan berakhir dan kamu perlu login kembali untuk mengakses fitur admin.</p>
    <div class="modal-buttons" style="gap:10px;">
      <button class="btn-cancel" onclick="closeLogoutModal()" style="flex:1;padding:12px;font-size:14px;border-radius:12px;">Batal</button>
      <button onclick="confirmLogout()" style="flex:1;padding:12px;font-size:14px;border-radius:12px;background:#ef4444;color:#fff;font-weight:700;">Logout</button>
    </div>
  </div>
</div>

<!-- Confirm Delete Show Modal -->
<div class="modal" id="confirmDeleteModal">
  <div class="modal-box" style="text-align:center;max-width:340px;">
    <div style="width:64px;height:64px;background:#fee2e2;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 16px;">
      <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/>
        <path d="M10 11v6"/><path d="M14 11v6"/>
        <path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/>
      </svg>
    </div>
    <h3 style="font-size:18px;font-weight:700;margin-bottom:6px;">Hapus Show?</h3>
    <div id="confirmDeleteDesc"></div>
    <div class="modal-buttons" style="gap:10px;">
      <button class="btn-cancel" onclick="closeConfirmDeleteModal()" style="flex:1;padding:12px;font-size:14px;border-radius:12px;">Batal</button>
      <button id="confirmDeleteBtn" style="flex:1;padding:12px;font-size:14px;border-radius:12px;background:#ef4444;color:#fff;font-weight:700;">Hapus</button>
    </div>
  </div>
</div>

<!-- Setlist Modal (Tambah Show) -->
<div class="modal" id="setlistModal">
  <div class="modal-box">

    <!-- Scrollable body -->
    <div class="modal-body">
      <div class="modal-header-block">
        <h3 style="display:flex;align-items:center;gap:8px;">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0;color:#e60012"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/><line x1="9" y1="15" x2="13" y2="15"/></svg>
          Tambah Show
        </h3>
        <p id="setlistMemberName">Member: -</p>
      </div>

      <!-- Tanggal & Jam â€” 2 kolom -->
      <div class="form-row">
        <div class="form-group">
          <label class="input-label">Tanggal Show</label>
          <input type="date" id="showDate">
        </div>
        <div class="form-group">
          <label class="input-label">Jam Show</label>
          <input type="time" id="showTime" placeholder="19:00">
        </div>
      </div>

      <!-- Setlist -->
      <label class="input-label">Pilih Setlist</label>
      <select id="setlistSelect" onchange="toggleCustomSetlistField()">
        <option value="">Pilih Setlist...</option>
        <option value="__custom__">Kustom Setlist (Ketik Manual)</option>
      </select>
      <div class="custom-setlist-field" id="customSetlistField">
        <label class="input-label">Nama Setlist Kustom</label>
        <input type="text" id="customSetlistName" placeholder="Masukkan nama setlist..." maxlength="100">
        <div class="tip-text"><svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0;vertical-align:middle;margin-right:5px"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>Masukkan nama setlist bebas sesuai keinginan</div>
      </div>
      <div class="setlist-info" id="setlistInfo" style="display:none">
        <span class="setlist-badge">INFO</span>
        <span id="setlistDescription"></span>
      </div>

      <div class="modal-divider"></div>

      <!-- Options: Birthday / Graduation / Non-Show -->
      <div class="options-grid">

        <!-- Birthday -->
        <div class="option-card birthday-card">
          <label class="option-card-row">
            <input type="checkbox" id="isBirthdayShow" onchange="toggleBirthdayField()">
            <span class="option-label" style="display:flex;align-items:center;gap:7px;">
              <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-8a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8"/><path d="M4 16s.5-1 2-1 2.5 2 4 2 2.5-2 4-2 2.5 2 4 2 2-1 2-1"/><path d="M2 21h20"/><path d="M7 8v3"/><path d="M12 8v3"/><path d="M17 8v3"/><path d="M7 4h0.01"/><path d="M12 4h0.01"/><path d="M17 4h0.01"/></svg>
              Birthday Show (STS)
            </span>
          </label>
          <div class="option-dropdown" id="birthdayMemberField">
            <select id="birthdayMember">
              <option value="">-- Pilih Member --</option>
            </select>
          </div>
        </div>

        <!-- Graduation -->
        <div class="option-card graduation-card">
          <label class="option-card-row">
            <input type="checkbox" id="isGraduationShow" onchange="toggleGraduationField()">
            <span class="option-label" style="display:flex;align-items:center;gap:7px;">
              <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>
              Graduation Show (Last Show)
            </span>
          </label>
          <div class="option-dropdown" id="graduationMemberField">
            <div class="option-warning" style="background:#dbeafe;color:#1e40af;display:flex;align-items:flex-start;gap:6px;border-radius:8px;padding:7px 10px;">
              <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0;margin-top:1px"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
              <span><strong>PERHATIAN:</strong> Ini adalah SHOW TERAKHIR member. Setelah graduation tidak bisa ditambah show lagi.</span>
            </div>
            <select id="graduationMember">
              <option value="">-- Pilih Member --</option>
            </select>
            <div class="option-warning" style="color:#dc2626;padding-left:0;display:flex;align-items:center;gap:5px;font-size:11px;margin-top:4px;">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
              Pastikan member ini benar-benar akan graduate. Aksi ini tidak dapat dibatalkan!
            </div>
          </div>
        </div>

        <!-- Non-Show -->
        <div class="option-card nonshow-card">
          <label class="option-card-row">
            <input type="checkbox" id="isNonShow" onchange="toggleSingleNonShowActivity()">
            <span class="option-label" style="display:flex;align-items:center;gap:7px;">
              <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/><line x1="9" y1="15" x2="15" y2="15"/></svg>
              Non-Show Activity (Ramadhan, dll)
            </span>
          </label>
          <div class="non-show-info" id="singleNonShowInfo" style="margin-top:8px;font-size:11px;display:flex;align-items:center;gap:5px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0"><polyline points="20 6 9 17 4 12"/></svg>
            <span><strong>TIDAK</strong> menambah jumlah show di data member.</span>
          </div>
        </div>

      </div>



    </div>

    <!-- Sticky footer â€” identik Bulk Add -->
    <div class="modal-footer" id="setlistFooter">
      <button class="btn-cancel" onclick="closeSetlistModal()">Batal</button>
      <button class="btn-add" onclick="addShowWithSetlist()">Tambah Show</button>
    </div>

  </div>
</div>

<!-- Bulk Add Modal -->
<div class="modal" id="bulkAddModal">
  <div class="modal-box">

    <!-- Scrollable body -->
    <div class="modal-body">
      <div class="modal-header-block">
        <h3 style="display:flex;align-items:center;gap:8px;">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0;color:#e60012"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/><line x1="9" y1="12" x2="15" y2="12"/><line x1="9" y1="16" x2="13" y2="16"/></svg>
          Bulk Add Show
        </h3>
        <p>Tambahkan beberapa member sekaligus dalam 1 setlist</p>
      </div>

      <!-- Tanggal & Jam â€” 2 kolom -->
      <div class="form-row">
        <div class="form-group">
          <label class="input-label">Tanggal Show</label>
          <input type="date" id="bulkShowDate">
        </div>
        <div class="form-group">
          <label class="input-label">Jam Show</label>
          <input type="time" id="bulkShowTime" placeholder="19:00">
        </div>
      </div>

      <!-- Setlist -->
      <label class="input-label">Pilih Setlist</label>
      <select id="bulkSetlistSelect" onchange="toggleBulkCustomSetlistField()">
        <option value="">Pilih Setlist...</option>
        <option value="__custom__">Kustom Setlist (Ketik Manual)</option>
      </select>
      <div class="custom-setlist-field" id="bulkCustomSetlistField">
        <label class="input-label">Nama Setlist Kustom</label>
        <input type="text" id="bulkCustomSetlistName" placeholder="Masukkan nama setlist..." maxlength="100">
      </div>

      <div class="modal-divider"></div>

      <!-- Options: Birthday / Graduation / Non-Show -->
      <div class="options-grid">

        <!-- Birthday -->
        <div class="option-card birthday-card">
          <label class="option-card-row">
            <input type="checkbox" id="bulkIsBirthdayShow" onchange="toggleBulkBirthdayField()">
            <span class="option-label" style="display:flex;align-items:center;gap:7px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-8a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8"/><path d="M4 16s.5-1 2-1 2.5 2 4 2 2.5-2 4-2 2.5 2 4 2 2-1 2-1"/><path d="M2 21h20"/><path d="M7 8v3"/><path d="M12 8v3"/><path d="M17 8v3"/><path d="M7 4h0.01"/><path d="M12 4h0.01"/><path d="M17 4h0.01"/></svg>
                Birthday Show (STS)
            </span>
          </label>
          <div class="option-dropdown" id="bulkBirthdayMemberField">
            <select id="bulkBirthdayMember">
              <option value="">-- Pilih Member --</option>
            </select>
          </div>
        </div>

        <!-- Graduation -->
        <div class="option-card graduation-card">
          <label class="option-card-row">
            <input type="checkbox" id="bulkIsGraduationShow" onchange="toggleBulkGraduationField()">
            <span class="option-label" style="display:flex;align-items:center;gap:7px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>
                Graduation Show (Last Show)
            </span>
          </label>
          <div class="option-dropdown" id="bulkGraduationMemberField">
            <div class="option-warning" style="background:#dbeafe;color:#1e40af;display:flex;align-items:flex-start;gap:6px;border-radius:8px;padding:7px 10px;">
              <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0;margin-top:1px"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
              <span>Hanya 1 member yang bisa graduate per bulk operation!</span>
            </div>
            <select id="bulkGraduationMember">
              <option value="">-- Pilih Member --</option>
            </select>
            <div class="option-warning" style="color:#dc2626;padding-left:0;display:flex;align-items:center;gap:5px;font-size:11px;margin-top:4px;">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
              Member lain tetap normal.
            </div>
          </div>
        </div>

        <!-- Non-Show -->
        <div class="option-card nonshow-card">
          <label class="option-card-row">
            <input type="checkbox" id="bulkIsNonShow" onchange="toggleNonShowActivity()">
            <span class="option-label" style="display:flex;align-items:center;gap:7px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/><line x1="9" y1="15" x2="15" y2="15"/></svg>
                Non-Show Activity (Ramadhan, dll)
            </span>
          </label>
          <div class="non-show-info" id="nonShowInfo" style="margin-top:8px;font-size:11px;display:flex;align-items:center;gap:5px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0"><polyline points="20 6 9 17 4 12"/></svg>
            <span><strong>TIDAK</strong> menambah jumlah show di data member.</span>
          </div>
        </div>

      </div>

      <!-- Member Names -->
      <label class="input-label">Nama Member <span style="font-weight:400;color:#9ca3af;">(pisahkan dengan koma)</span></label>
      <textarea class="member-textarea" id="bulkMemberNames" placeholder="Contoh: Cynthia, Danella, Eli, Elin, Ella, Fritzy, Indah, Kimmy"></textarea>
      <div class="tip-text" style="margin-top:6px;"><svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0;vertical-align:middle;margin-right:5px"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>Nama harus persis sama dengan database (tidak case sensitive)</div>
    </div>

    <!-- Sticky footer buttons -->
    <div class="modal-footer">
      <button class="btn-cancel" onclick="closeBulkAddModal()">Batal</button>
      <button class="btn-add" id="bulkAddBtn" onclick="bulkAddShows()" style="display:flex;align-items:center;justify-content:center;gap:7px;">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
        Tambah Semua
      </button>
    </div>

  </div>
</div>

</div>

<!-- Edit Show Modal -->
<div class="modal" id="editShowModal">
  <div class="modal-box">
    <button class="modal-theme-toggle" onclick="toggleTheme()">
      <svg id="editModalThemeIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"/>
      </svg>
    </button>
    <h3>Edit Show</h3>
    <p id="editShowOriginalInfo">Mengedit show...</p>
    
    <label class="input-label">Member</label>
    <select id="editMemberSelect">
      <option value="">-- Pilih Member --</option>
    </select>
    
    <label class="input-label">Tanggal Show</label>
    <input type="date" id="editShowDate">
    
    <label class="input-label">Jam Show (HH:MM)</label>
    <input type="time" id="editShowTime">
    
    <label class="input-label">Setlist</label>
    <select id="editSetlistSelect" onchange="toggleEditCustomSetlistField()">
      <option value="">Pilih Setlist...</option>
      <option value="__custom__">Kustom Setlist (Ketik Manual)</option>
    </select>
    
    <!-- Custom Setlist Field untuk Edit -->
    <div class="custom-setlist-field" id="editCustomSetlistField">
        <label class="input-label">Nama Setlist Kustom</label>
        <input type="text" id="editCustomSetlistName" placeholder="Masukkan nama setlist..." maxlength="100">
        <div class="tip-text"><svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0;vertical-align:middle;margin-right:5px"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>Masukkan nama setlist bebas sesuai keinginan</div>
    </div>
    
    <div class="birthday-section">
      <label class="birthday-checkbox-label">
        <input type="checkbox" id="editIsBirthdayShow" onchange="toggleEditBirthdayField()">
        <span>Birthday Show (STS)</span>
      </label>
      
      <div class="birthday-dropdown" id="editBirthdayMemberField">
        <label class="input-label">Member yang Ulang Tahun</label>
        <select id="editBirthdayMember">
          <option value="">-- Pilih Member --</option>
        </select>
      </div>
    </div>
    
    <div class="graduation-section">
      <label class="graduation-checkbox-label">
        <input type="checkbox" id="editIsGraduationShow" onchange="toggleEditGraduationField()">
        <span style="color: #1e40af;">Graduation Show (Last Show)</span>
      </label>
      
      <div class="graduation-dropdown" id="editGraduationMemberField">
        <div class="tip-text" style="background: #dbeafe; color: #1e40af; border-radius: 8px; padding: 8px; margin-bottom: 10px;">
          <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0;vertical-align:middle;margin-right:5px"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg><strong>PERHATIAN:</strong> Centang jika ini adalah show terakhir untuk member!
        </div>
        
        <label class="input-label">Member yang Graduate</label>
        <select id="editGraduationMember">
          <option value="">-- Pilih Member --</option>
        </select>
      </div>
    </div>
    
    <div class="modal-buttons">
      <button class="btn-cancel" onclick="closeEditShowModal()">Batal</button>
      <button class="btn-confirm" onclick="saveEditShow()" style="background:#3b82f6;color:#fff">Simpan Perubahan</button>
    </div>
  </div>
</div>

<script>
var SUPABASE_URL='https://pprxfopqkvpeajeoxzig.supabase.co';
var SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBwcnhmb3Bxa3ZwZWFqZW94emlnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyNTI4MTIsImV4cCI6MjA4MTgyODgxMn0.iXRO_dAHhtVHRLqGTresG_63RD2zIaopNXtXYNfthdg';
var ADMIN_ACCOUNTS={'admin@jkt48.com':'jkt48admin','superadmin@jkt48.com':'jkt48super'};
var GEN_COLORS={3:'#ec4899',6:'#22c55e',7:'#15803d',8:'#1e40af',9:'#06b6d4',10:'#38bdf8',11:'#f97316',12:'#fde68a',13:'#facc15',14:'#e879f9'};
var SETLIST_INTI={'Cara Meminum Ramune':'Setlist segar seperti minuman ramune','Te Wo Tsunaginagara':'Setlist sambil bergandengan tangan','Pertaruhan Cinta':'Setlist tentang taruhan cinta untuk member inti'};
var SETLIST_TRAINEE={'Pajama Drive':'Setlist klasik untuk member trainee'};
var SETLIST_INFO=Object.assign({},SETLIST_INTI,SETLIST_TRAINEE);
var db=supabase.createClient(SUPABASE_URL,SUPABASE_KEY);
var members=[];
var currentGen='all';
var currentStatus='all';
var searchQuery='';
var activityLog=[];
var currentMemberId=null;

// Mapping untuk lookup cepat
var memberIdMap = {}; // { memberName: memberId }
var memberNameMap = {}; // { memberId: memberName }



// Edit show variables
var currentEditShowId = null;
var currentEditShowData = null;

// Notification System
function showNotification(type, title, message, duration = 3000) {
    const container = document.getElementById('notificationContainer');
    const id = 'notif_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    
    const notification = document.createElement('div');
    notification.className = `notification-item notification-${type}`;
    notification.id = id;
    
    const text = message || title;
    notification.innerHTML = `<span class="notification-dot"></span><span>${text}</span>`;
    
    container.appendChild(notification);
    
    if (duration > 0) {
        setTimeout(() => { removeNotification(id); }, duration);
    }
    
    return id;
}

function removeNotification(id) {
    const notification = document.getElementById(id);
    if (notification) {
        notification.classList.add('hiding');
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }
}

// Replace old showToast function with new notification system
function showToast(message, isError) {
    if (isError) {
        showNotification('error', 'Error', message);
    } else {
        showNotification('success', 'Success', message);
    }
}

function getTodayDate() {
    const now = new Date();
    const year = now.getFullYear();
    const month = String(now.getMonth() + 1).padStart(2, '0');
    const day = String(now.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
}

function getCurrentTime() {
    const now = new Date();
    const hours = String(now.getHours()).padStart(2, '0');
    const minutes = String(now.getMinutes()).padStart(2, '0');
    return `${hours}:${minutes}`;
}

function toggleTheme(){
    var b=document.body;
    var i=document.getElementById('themeIcon');
    var e=document.getElementById('editModalThemeIcon');
    b.classList.toggle('dark');
    var isDark = b.classList.contains('dark');
    // Update setlist footer background
    var sf = document.getElementById('setlistFooter');
    if (sf) sf.style.background = isDark ? '#111827' : '#fff';
    if(isDark){
        var s='<path d="M12,17a5,5,0,1,1,5-5A5,5,0,0,1,12,17Zm0-8a3,3,0,1,0,3,3A3,3,0,0,0,12,9Zm0-4a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41L6.34,5A1,1,0,0,0,4.93,6.34ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm.64,5.66a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71a1,1,0,0,0-1.41-1.41ZM12,19a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19Zm6.36-2.34a1,1,0,0,0-1.41,1.41l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-3.64-3.95a1,1,0,0,0,.7.29,1,1,0,0,0,.71-1.7l-.71-.71a1,1,0,0,0-1.41,1.41Z"/>';
        if(i)i.innerHTML=s; if(e)e.innerHTML=s;
        localStorage.setItem('jkt48_theme','dark');
    }else{
        var n='<path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"/>';
        if(i)i.innerHTML=n; if(e)e.innerHTML=n;
        localStorage.setItem('jkt48_theme','light');
    }
}

var savedTheme=localStorage.getItem('jkt48_theme');
if(savedTheme==='dark'){
    document.body.classList.add('dark');
}

var adminEmail=localStorage.getItem('jkt48_admin_email');
var loginTime=localStorage.getItem('jkt48_admin_login_time');
var _needLogin = false;
if(!adminEmail||!loginTime){
    _needLogin = true;
    setTimeout(function(){document.getElementById('email').focus()},100);
}else{
    var currentTime=new Date().getTime();
    var sessionAge=currentTime-parseInt(loginTime);
    if(sessionAge>86400000){
        localStorage.removeItem('jkt48_admin_email');
        localStorage.removeItem('jkt48_admin_login_time');
        showNotification('warning', 'Session Expired', 'Sesi berakhir, silakan login ulang');
        _needLogin = true;
    }else{
        loadData();
        loadActivityLog();
    }
}

async function loadData(){
    try{
        console.log('Memuat data dari Supabase...');
        showNotification('info', 'Loading', 'Memuat data...', 2000);
        
        var result=await db.from('members').select('*').order('name');
        
        if(result.error){
            console.error('Error dari Supabase:', result.error);
            throw result.error;
        }
        
        members=result.data||[];
        console.log('Berhasil memuat '+members.length+' member');
        
        // Update mapping
        updateMemberMappings();
        
        renderMembers();
        updateStats();
        updateLoginStats();
        
    }catch(err){
        console.error('Error:',err);
        document.getElementById('list').innerHTML='<div class="msg" style="color:#ef4444">Error: '+err.message+'</div>';
        showNotification('error', 'Load Error', 'Gagal memuat data: ' + err.message);
    }
}

function updateMemberMappings() {
    memberIdMap = {};
    memberNameMap = {};
    
    members.forEach(function(member) {
        memberIdMap[member.name.toLowerCase()] = member.id;
        memberNameMap[member.id] = member.name;
    });
}

function updateLoginStats() {
    var activeMembers = members.filter(function(m){ return m.status !== 'graduated'; });
    var elM = document.getElementById('loginStatMembers');
    var elG = document.getElementById('loginStatGen');
    if (elM) elM.textContent = activeMembers.length;
    if (elG) elG.textContent = '14';
}

function loadActivityLog(){
    var saved=localStorage.getItem('jkt48_activity_log');
    if(saved){
        activityLog=JSON.parse(saved);
        var today=new Date().toDateString();
        activityLog=activityLog.filter(function(log){
            return new Date(log.time).toDateString()===today;
        });
    }
    renderActivityLog();
}

function saveActivityLog(){
    localStorage.setItem('jkt48_activity_log',JSON.stringify(activityLog));
}

function addActivity(memberName,change,newValue,setlist,status){
    var activity={
        member:memberName,
        change:change,
        newValue:newValue,
        setlist:setlist||null,
        status:status||'inti',
        time:new Date().toISOString()
    };
    activityLog.unshift(activity);
    if(activityLog.length>50) activityLog=activityLog.slice(0,50);
    saveActivityLog();
    renderActivityLog();
}

function addActivityFailed(failedEntry){
    var activity={
        member:failedEntry,
        change:0,
        newValue:null,
        setlist:null,
        status:'failed',
        time:new Date().toISOString()
    };
    activityLog.unshift(activity);
    if(activityLog.length>50) activityLog=activityLog.slice(0,50);
    saveActivityLog();
    renderActivityLog();
}

function renderActivityLog(){
    var logEl=document.getElementById('activityLog');
    if(activityLog.length===0){
        logEl.innerHTML='<div class="activity-empty">Belum ada aktivitas hari ini</div>';
        return;
    }
    logEl.innerHTML=activityLog.map(function(log){
        var time=new Date(log.time);
        var timeStr=time.toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit'});
        
        if(log.status==='failed'){
            return'<div class="activity-item" style="--color:#ef4444"><div class="activity-icon">âœ—</div><div class="activity-content"><div class="activity-text" style="color:#ef4444">Gagal: '+log.member+'</div><div class="activity-time">'+timeStr+' â€¢ Bulk Add Gagal</div></div></div>';
        }
        
        var icon=log.change>0?'+':'âˆ’';
        var color=log.change>0?'#22c55e':'#ef4444';
        var action=log.change>0?'+':'';
        var setlistText=log.setlist?' ('+log.setlist+')':'';
        var statusBadge=log.status==='trainee'?' [TRAINEE]':'';
        return'<div class="activity-item" style="--color:'+color+'"><div class="activity-icon">'+icon+'</div><div class="activity-content"><div class="activity-text">'+log.member+statusBadge+' '+action+log.change+' â†’ '+log.newValue+' show'+setlistText+'</div><div class="activity-time">'+timeStr+'</div></div></div>';
    }).join('');
}

function clearActivityLog(){
    if(confirm('Hapus semua activity log?')){
        activityLog=[];
        saveActivityLog();
        renderActivityLog();
        showNotification('success', 'Activity Log', 'Log dihapus');
    }
}

function renderMembers(){
    var list=document.getElementById('list');
    var filtered=members.filter(function(m){
        var matchGen=currentGen==='all'||m.gen==currentGen;
        var matchStatus=currentStatus==='all'||m.status===currentStatus;
        var matchSearch=!searchQuery||m.name.toLowerCase().includes(searchQuery.toLowerCase());
        return matchGen&&matchStatus&&matchSearch;
    });
    
    if(filtered.length===0){
        var message = 'Tidak ada data member';
        if(searchQuery){
            message = 'Tidak ada member dengan nama "'+searchQuery+'"';
        }else if(currentStatus!=='all' && currentGen!=='all'){
            message = 'Tidak ada '+currentStatus+' Generasi '+currentGen;
        }else if(currentStatus!=='all'){
            message = 'Tidak ada member '+currentStatus;
        }else if(currentGen!=='all'){
            message = 'Tidak ada member Generasi '+currentGen;
        }
        list.innerHTML='<div class="msg">'+message+'</div>';
        return;
    }
    
    list.innerHTML='';
    var sorted=filtered.sort(function(a,b){return b.show-a.show});
    sorted.forEach(function(m){
        var percent=Math.min(100,(m.show/1000)*100);
        var color=GEN_COLORS[m.gen]||'#6366f1';
        var card=document.createElement('div');
        card.className='card'+(m.status==='trainee'?' trainee':'')+(m.status==='graduated'?' graduated':'');
        card.style.setProperty('--gen-color',color);
        
        var statusBadgeHtml='';
        if(m.status==='graduated'){
            statusBadgeHtml='<div class="status-badge graduated">GRADUATED</div>';
        }else if(m.status==='trainee'){
            statusBadgeHtml='<div class="status-badge trainee">TRAINEE</div>';
        }else{
            statusBadgeHtml='<div class="status-badge">INTI</div>';
        }
        
        var firstChar = m.name.charAt(0);
        card.innerHTML=
            '<div class="avatar-wrap">'+
                '<img class="avatar" src="img/'+m.name.toLowerCase()+'.jpg" onerror="this.onerror=null;this.style.display=\'none\';var p=document.createElement(\'div\');p.className=\'avatar-placeholder\';p.textContent=\''+firstChar+'\';this.parentNode.appendChild(p);" alt="'+m.name+'">'+
                '<div class="avatar-overlay"></div>'+
                statusBadgeHtml+
            '</div>'+
            '<div class="card-footer">'+
                '<div class="gen-badge">Gen '+m.gen+'</div>'+
                '<div class="name">'+m.name+'</div>'+
                '<div class="show"><span class="show-num">'+m.show+'</span>&nbsp;show</div>'+
                '<div class="bar"><span style="width:'+percent+'%"></span></div>'+
                '<div class="admin-controls">'+
                    '<button onclick="updateShow('+m.id+',-1)" title="Kurang show" '+(m.status==='graduated'?'disabled': '')+'>âˆ’</button>'+
                    '<button onclick="openSetlistModal('+m.id+')" title="Tambah show" '+(m.status==='graduated'?'disabled': '')+' style="background:rgba(255,255,255,0.25);">+</button>'+
                '</div>'+
            '</div>';
        list.appendChild(card);
    });
}

// =================== HELPER FUNCTIONS ===================

function formatDate(dateString) {
    if (!dateString) return '-';
    const date = new Date(dateString);
    const day = date.getDate();
    const month = date.toLocaleDateString('id-ID', { month: 'short' });
    const year = date.getFullYear();
    return `${day} ${month} ${year}`;
}

function formatTime(timeString) {
    if (!timeString) return '-';
    const parts = timeString.split(':');
    return `${parts[0]}:${parts[1]}`;
}

function formatShortDate(dateString) {
    if (!dateString) return '-';
    const date = new Date(dateString);
    const day = date.getDate();
    const month = date.getMonth() + 1;
    return `${day}/${month}`;
}

function isShowPast(showDate, showTime) {
    if (!showDate || !showTime) return false;
    
    var now = new Date();
    var timePart = showTime.length === 5 ? showTime + ':00' : showTime;
    var showDateTime = new Date(showDate + 'T' + timePart);
    
    return now > showDateTime;
}

function isToday(dateString) {
    var today = new Date().toISOString().split('T')[0];
    return dateString === today;
}

function isThisWeek(dateString) {
    var now = new Date();
    var target = new Date(dateString);
    
    // Set both dates to start of day
    var startOfWeek = new Date(now);
    startOfWeek.setHours(0, 0, 0, 0);
    
    var endOfWeek = new Date(startOfWeek);
    endOfWeek.setDate(startOfWeek.getDate() + 7); // 7 hari ke depan
    endOfWeek.setHours(23, 59, 59, 999);
    
    target.setHours(0, 0, 0, 0);
    
    return target >= startOfWeek && target <= endOfWeek;
}

// =================== CUSTOM SETLIST FUNCTIONS ===================

function toggleCustomSetlistField() {
    var select = document.getElementById('setlistSelect');
    var customField = document.getElementById('customSetlistField');
    var setlistInfo = document.getElementById('setlistInfo');
    
    if (select.value === '__custom__') {
        customField.classList.add('show');
        setlistInfo.style.display = 'none';
        document.getElementById('customSetlistName').focus();
    } else {
        customField.classList.remove('show');
        if (select.value) {
            setlistInfo.style.display = 'block';
            document.getElementById('setlistDescription').textContent = SETLIST_INFO[select.value] || '';
        } else {
            setlistInfo.style.display = 'none';
        }
    }
}

function toggleBulkCustomSetlistField() {
    var select = document.getElementById('bulkSetlistSelect');
    var customField = document.getElementById('bulkCustomSetlistField');
    
    if (select.value === '__custom__') {
        customField.classList.add('show');
        document.getElementById('bulkCustomSetlistName').focus();
    } else {
        customField.classList.remove('show');
    }
}

function toggleEditCustomSetlistField() {
    var select = document.getElementById('editSetlistSelect');
    var customField = document.getElementById('editCustomSetlistField');
    
    if (select.value === '__custom__') {
        customField.classList.add('show');
        document.getElementById('editCustomSetlistName').focus();
    } else {
        customField.classList.remove('show');
    }
}

function getSelectedSetlist(selectId, customInputId) {
    var select = document.getElementById(selectId);
    var customInput = document.getElementById(customInputId);
    
    if (select.value === '__custom__') {
        var customName = customInput.value.trim();
        if (!customName) {
            showNotification('warning', 'Validasi', 'Masukkan nama setlist');
            return null;
        }
        return customName;
    } else {
        return select.value;
    }
}

// =================== BIRTHDAY & GRADUATION FUNCTIONS ===================

// Fungsi utama untuk toggle
function toggleSingleNonShowActivity() {
    var checkbox = document.getElementById('isNonShow');
    var birthdayCheckbox = document.getElementById('isBirthdayShow');
    var graduationCheckbox = document.getElementById('isGraduationShow');
    var birthdayCard = birthdayCheckbox ? birthdayCheckbox.closest('.option-card') : null;
    var graduationCard = graduationCheckbox ? graduationCheckbox.closest('.option-card') : null;

    if (checkbox.checked) {
        if (birthdayCheckbox) {
            birthdayCheckbox.checked = false;
            birthdayCheckbox.disabled = true;
            birthdayCheckbox.style.opacity = '0.35';
            birthdayCheckbox.style.cursor = 'not-allowed';
            var bLabel = birthdayCheckbox.closest('label');
            if (bLabel) bLabel.style.pointerEvents = 'none';
            document.getElementById('birthdayMemberField').classList.remove('show');
        }
        if (graduationCheckbox) {
            graduationCheckbox.checked = false;
            graduationCheckbox.disabled = true;
            graduationCheckbox.style.opacity = '0.35';
            graduationCheckbox.style.cursor = 'not-allowed';
            var gLabel = graduationCheckbox.closest('label');
            if (gLabel) gLabel.style.pointerEvents = 'none';
            document.getElementById('graduationMemberField').classList.remove('show');
        }
    } else {
        if (birthdayCheckbox) {
            birthdayCheckbox.disabled = false; birthdayCheckbox.style.opacity = ''; birthdayCheckbox.style.cursor = '';
            var bLabel = birthdayCheckbox.closest('label');
            if (bLabel) bLabel.style.pointerEvents = '';
        }
        if (graduationCheckbox) {
            graduationCheckbox.disabled = false; graduationCheckbox.style.opacity = ''; graduationCheckbox.style.cursor = '';
            var gLabel = graduationCheckbox.closest('label');
            if (gLabel) gLabel.style.pointerEvents = '';
        }
    }
}

function toggleBirthdayField() {
    var checkbox = document.getElementById('isBirthdayShow');
    var graduationCheckbox = document.getElementById('isGraduationShow');
    var nonShowCheckbox = document.getElementById('isNonShow');
    var field = document.getElementById('birthdayMemberField');
    
    if (checkbox.checked) {
        if (graduationCheckbox.checked) {
            showNotification('warning', 'Konflik', 'Birthday & Graduation tidak bisa bersamaan');
            checkbox.checked = false;
            return;
        }
        if (nonShowCheckbox && nonShowCheckbox.checked) {
            showNotification('warning', 'Konflik', 'Birthday & Non-Show tidak bisa bersamaan');
            checkbox.checked = false;
            return;
        }
        field.classList.add('show');
        populateMemberDropdown('birthdayMember');
    } else {
        field.classList.remove('show');
        document.getElementById('birthdayMember').value = '';
    }
}

function toggleGraduationField() {
    var checkbox = document.getElementById('isGraduationShow');
    var birthdayCheckbox = document.getElementById('isBirthdayShow');
    var nonShowCheckbox = document.getElementById('isNonShow');
    var field = document.getElementById('graduationMemberField');
    
    if (checkbox.checked) {
        if (birthdayCheckbox.checked) {
            showNotification('warning', 'Konflik', 'Birthday & Graduation tidak bisa bersamaan');
            checkbox.checked = false;
            return;
        }
        if (nonShowCheckbox && nonShowCheckbox.checked) {
            showNotification('warning', 'Konflik', 'Graduation & Non-Show tidak bisa bersamaan');
            checkbox.checked = false;
            return;
        }
        field.classList.add('show');
        populateMemberDropdown('graduationMember');
    } else {
        field.classList.remove('show');
        document.getElementById('graduationMember').value = '';
    }
}

function toggleNonShowActivity() {
    var checkbox = document.getElementById('bulkIsNonShow');
    var info = document.getElementById('nonShowInfo');
    var btn = document.getElementById('bulkAddBtn');
    var birthdayCheckbox = document.getElementById('bulkIsBirthdayShow');
    var graduationCheckbox = document.getElementById('bulkIsGraduationShow');

    if (checkbox.checked) {
        btn.textContent = 'Tambah Aktivitas';
        btn.style.background = '#22c55e';
        // Disable birthday & graduation jika non-show
        if (birthdayCheckbox.checked) {
            birthdayCheckbox.checked = false;
            document.getElementById('bulkBirthdayMemberField').classList.remove('show');
        }
        if (graduationCheckbox.checked) {
            graduationCheckbox.checked = false;
            document.getElementById('bulkGraduationMemberField').classList.remove('show');
        }
        birthdayCheckbox.disabled = true;
        graduationCheckbox.disabled = true;
    } else {
        btn.textContent = 'Tambah Semua';
        btn.style.background = '';
        birthdayCheckbox.disabled = false;
        graduationCheckbox.disabled = false;
    }
}


function toggleBulkBirthdayField() {
    var checkbox = document.getElementById('bulkIsBirthdayShow');
    var graduationCheckbox = document.getElementById('bulkIsGraduationShow');
    var field = document.getElementById('bulkBirthdayMemberField');
    
    if (checkbox.checked) {
        if (graduationCheckbox.checked) {
            showNotification('warning', 'Konflik', 'Birthday & Graduation tidak bisa bersamaan');
            checkbox.checked = false;
            return;
        }
        field.classList.add('show');
        populateMemberDropdown('bulkBirthdayMember');
    } else {
        field.classList.remove('show');
        document.getElementById('bulkBirthdayMember').value = '';
    }
}

function toggleBulkGraduationField() {
    var checkbox = document.getElementById('bulkIsGraduationShow');
    var birthdayCheckbox = document.getElementById('bulkIsBirthdayShow');
    var field = document.getElementById('bulkGraduationMemberField');
    
    if (checkbox.checked) {
        if (birthdayCheckbox.checked) {
            showNotification('warning', 'Konflik', 'Birthday & Graduation tidak bisa bersamaan');
            checkbox.checked = false;
            return;
        }
        field.classList.add('show');
        populateMemberDropdown('bulkGraduationMember');
    } else {
        field.classList.remove('show');
        document.getElementById('bulkGraduationMember').value = '';
    }
}

function toggleEditBirthdayField() {
    var checkbox = document.getElementById('editIsBirthdayShow');
    var graduationCheckbox = document.getElementById('editIsGraduationShow');
    var field = document.getElementById('editBirthdayMemberField');
    
    if (checkbox.checked) {
        if (graduationCheckbox.checked) {
            showNotification('warning', 'Konflik', 'Birthday & Graduation tidak bisa bersamaan');
            checkbox.checked = false;
            return;
        }
        field.classList.add('show');
        populateMemberDropdown('editBirthdayMember');
    } else {
        field.classList.remove('show');
        document.getElementById('editBirthdayMember').value = '';
    }
}

function toggleEditGraduationField() {
    var checkbox = document.getElementById('editIsGraduationShow');
    var birthdayCheckbox = document.getElementById('editIsBirthdayShow');
    var field = document.getElementById('editGraduationMemberField');
    
    if (checkbox.checked) {
        if (birthdayCheckbox.checked) {
            showNotification('warning', 'Konflik', 'Birthday & Graduation tidak bisa bersamaan');
            checkbox.checked = false;
            return;
        }
        field.classList.add('show');
        populateMemberDropdown('editGraduationMember');
    } else {
        field.classList.remove('show');
        document.getElementById('editGraduationMember').value = '';
    }
}

// Fungsi helper untuk populate dropdown
function populateMemberDropdown(dropdownId) {
    var dropdown = document.getElementById(dropdownId);
    if (!dropdown) {
        console.error('Dropdown not found:', dropdownId);
        return;
    }
    
    // Simpan nilai yang dipilih sebelumnya
    var previousValue = dropdown.value;
    
    dropdown.innerHTML = '<option value="">-- Pilih Member --</option>';
    
    var sortedMembers = members.slice().sort(function(a, b) {
        return a.name.localeCompare(b.name);
    });
    
    sortedMembers.forEach(function(member) {
        if (member.status !== 'graduated') {
            var selected = (member.name === previousValue) ? 'selected' : '';
            dropdown.innerHTML += '<option value="' + member.name + '" ' + selected + '>' + member.name + '</option>';
        }
    });
}

// =================== OPEN SETLIST MODAL ===================

function openSetlistModal(memberId){
    currentMemberId=memberId;
    var member=members.find(function(m){return m.id===memberId});
    if(!member) return;
    
    if(member.status==='graduated'){
        showNotification('warning', 'Graduated', member.name+' sudah graduated');
        return;
    }
    
    document.getElementById('setlistMemberName').textContent='Member: '+member.name+' ('+(member.status==='trainee'?'TRAINEE':'INTI')+')';
    
    document.getElementById('showDate').value = getTodayDate();
    document.getElementById('showTime').value = '19:00';
    
    var selectEl=document.getElementById('setlistSelect');
    selectEl.innerHTML='<option value="">Pilih Setlist...</option>';
    
    // Tambahkan opsi kustom setlist
    selectEl.innerHTML += '<option value="__custom__">Kustom Setlist (Ketik Manual)</option>';
    
    var setlists=member.status==='trainee'?SETLIST_TRAINEE:SETLIST_INTI;
    for(var key in setlists){
        selectEl.innerHTML+='<option value="'+key+'">'+key+'</option>';
    }
    selectEl.value='';
    
    // Sembunyikan custom field dan info
    document.getElementById('customSetlistField').classList.remove('show');
    document.getElementById('customSetlistName').value = '';
    document.getElementById('setlistInfo').style.display='none';
    
    // Reset semua checkbox
    document.getElementById('isBirthdayShow').checked = false;
    document.getElementById('birthdayMember').value = '';
    document.getElementById('birthdayMemberField').classList.remove('show');
    
    document.getElementById('isGraduationShow').checked = false;
    document.getElementById('graduationMember').value = member.name; // Auto select current member
    document.getElementById('graduationMemberField').classList.remove('show');
    
    // Reset non-show
    document.getElementById('isNonShow').checked = false;
    
    // Reset nama member manual
    var nameInput = document.getElementById('setlistMemberNameInput');
    if (nameInput) nameInput.value = '';
    
    // Dark mode footer
    var footer = document.getElementById('setlistFooter');
    if (footer) footer.style.background = document.body.classList.contains('dark') ? '#111827' : '#fff';
    
    // Pre-populate dropdowns
    populateMemberDropdown('birthdayMember');
    populateMemberDropdown('graduationMember');
    
    document.getElementById('setlistModal').style.display='flex';
}

function closeSetlistModal(){
    document.getElementById('setlistModal').style.display='none';
    currentMemberId=null;
    var nameInput = document.getElementById('setlistMemberNameInput');
    if (nameInput) nameInput.value = '';
}

// =================== BULK ADD MODAL ===================

function openBulkAddModal(){
    document.getElementById('bulkShowDate').value = getTodayDate();
    document.getElementById('bulkShowTime').value = '19:00';
    
    var selectEl=document.getElementById('bulkSetlistSelect');
    selectEl.innerHTML='<option value="">Pilih Setlist...</option>';
    
    // Tambahkan opsi kustom setlist
    selectEl.innerHTML += '<option value="__custom__">Kustom Setlist (Ketik Manual)</option>';
    
    for(var key in SETLIST_INFO){
        selectEl.innerHTML+='<option value="'+key+'">'+key+'</option>';
    }
    
    // Reset custom field
    document.getElementById('bulkCustomSetlistField').classList.remove('show');
    document.getElementById('bulkCustomSetlistName').value = '';
    
    document.getElementById('bulkMemberNames').value='';
    
    // Reset semua checkbox di bulk modal
    document.getElementById('bulkIsBirthdayShow').checked = false;
    document.getElementById('bulkBirthdayMember').value = '';
    document.getElementById('bulkBirthdayMemberField').classList.remove('show');
    
    document.getElementById('bulkIsGraduationShow').checked = false;
    document.getElementById('bulkGraduationMember').value = '';
    document.getElementById('bulkGraduationMemberField').classList.remove('show');
    
    // Pre-populate dropdowns
    populateMemberDropdown('bulkBirthdayMember');
    populateMemberDropdown('bulkGraduationMember');
    
    // Reset non-show activity
    document.getElementById('bulkIsNonShow').checked = false;
    document.getElementById('bulkAddBtn').textContent = 'Tambah Semua';
    document.getElementById('bulkAddBtn').style.background = '';
    document.getElementById('bulkIsBirthdayShow').disabled = false;
    document.getElementById('bulkIsGraduationShow').disabled = false;

    document.getElementById('bulkAddModal').style.display='flex';
}

function closeBulkAddModal(){
    document.getElementById('bulkAddModal').style.display='none';
}

// =================== SHOW MANAGEMENT FUNCTIONS ===================

async function addShowWithSetlist(){
    // Dapatkan setlist (bisa dari pilihan atau custom)
    var setlist = getSelectedSetlist('setlistSelect', 'customSetlistName');
    if (!setlist) return; // Error sudah ditampilkan di getSelectedSetlist
    
    var showDate=document.getElementById('showDate').value;
    var showTime=document.getElementById('showTime').value;
    var isBirthdayShow=document.getElementById('isBirthdayShow').checked;
    var birthdayMember=document.getElementById('birthdayMember').value;
    var isGraduationShow=document.getElementById('isGraduationShow').checked;
    var graduationMember=document.getElementById('graduationMember').value;
    var isNonShow=document.getElementById('isNonShow').checked;
    
    if(!setlist){
        showNotification('warning', 'Peringatan', 'Pilih setlist dulu');
        return;
    }
    
    if(!showDate){
        showDate = getTodayDate();
    }
    
    if(!showTime){
        showTime = '19:00:00';
    } else {
        if (showTime.length === 5) {
            showTime = showTime + ':00';
        }
    }
    
    // Cek apakah ada input nama manual (untuk retry bulk add yang gagal)
    var manualName = document.getElementById('setlistMemberNameInput') ? document.getElementById('setlistMemberNameInput').value.trim() : '';
    var member = null;
    
    if (manualName) {
        // Cari member berdasarkan nama yang diketik
        member = members.find(function(m){ return m.name.toLowerCase() === manualName.toLowerCase(); });
        if (!member) {
            showNotification('error', 'Tidak Ditemukan', '"' + manualName + '" tidak ada di database');
            return;
        }
        currentMemberId = member.id;
    } else {
        if(!currentMemberId) return;
        member = members.find(function(m){return m.id===currentMemberId});
        if(!member) return;
    }
    
    if(member.status === 'graduated'){
        showNotification('error', 'Graduated', member.name+' sudah graduated');
        closeSetlistModal();
        return;
    }
    
    if (isBirthdayShow && isGraduationShow) {
        showNotification('error', 'Konflik', 'Birthday & Graduation tidak bisa bersamaan');
        return;
    }
    
    try {
        var setlistData={
            member_id: currentMemberId,
            setlist_name:setlist,
            show_date:showDate,
            show_time:showTime,
            is_birthday_show: isBirthdayShow,
            birthday_member: isBirthdayShow ? birthdayMember : null,
            is_graduation_show: isGraduationShow,
            graduation_member: isGraduationShow ? graduationMember : null,
            is_non_show: isNonShow,
            created_at:new Date().toISOString()
        };
        
        var insertResult=await db.from('setlist_performance')
            .insert([setlistData])
            .select();
        
        if(insertResult.error){
            console.error('Insert error:',insertResult.error);
            showNotification('error', 'Insert Error', 'Gagal insert setlist: '+insertResult.error.message);
            return;
        }
        
        // Reload data members untuk mendapatkan count yang updated dari trigger
        await loadData();
        
        // Add activity log
        var activityText = '';
        if (isGraduationShow) {
            activityText = setlist + ' (LAST SHOW - ' + graduationMember + ')';
        } else if (isBirthdayShow) {
            activityText = setlist + ' (STS ' + birthdayMember + ')';
        } else if (isNonShow) {
            activityText = setlist + ' (Non-Show)';
        } else {
            activityText = setlist;
        }
        
        // For non-show, don't count as a show (change=0)
        addActivity(member.name, isNonShow ? 0 : 1, member.show, activityText, member.status);
        
        // Close modal
        closeSetlistModal();
        
        // Show success notification
        var successMessage = '';
        if (isGraduationShow) {
            successMessage = '[GRADUATED] ' + member.name + ' telah GRADUATED! Last show: ' + member.show + ' show (' + activityText + ')';
            showNotification('success', 'Graduation Success', successMessage);
        } else if (isNonShow) {
            successMessage = member.name + ': Non-Show Activity dicatat (' + activityText + ' - ' + formatDate(showDate) + ' ' + formatTime(showTime) + ')';
            showNotification('success', 'Non-Show Dicatat', successMessage);
        } else {
            successMessage = member.name + ': ' + member.show + ' show (' + activityText + ' - ' + formatDate(showDate) + ' ' + formatTime(showTime) + ')';
            showNotification('success', 'Show Added', successMessage);
        }
        
    } catch(err) {
        console.error('Exception:',err);
        showNotification('error', 'Error', 'Error: '+err.message);
    }
}

async function bulkAddShows(){
    // Dapatkan setlist (bisa dari pilihan atau custom)
    var setlist = getSelectedSetlist('bulkSetlistSelect', 'bulkCustomSetlistName');
    if (!setlist) return; // Error sudah ditampilkan di getSelectedSetlist
    
    var namesInput=document.getElementById('bulkMemberNames').value;
    var showDate=document.getElementById('bulkShowDate').value;
    var showTime=document.getElementById('bulkShowTime').value;
    var isBirthdayShow=document.getElementById('bulkIsBirthdayShow').checked;
    var birthdayMember=document.getElementById('bulkBirthdayMember').value;
    var isGraduationShow=document.getElementById('bulkIsGraduationShow').checked;
    var graduationMember=document.getElementById('bulkGraduationMember').value;
    var isNonShow=document.getElementById('bulkIsNonShow').checked;
    
    if(!setlist){
        showNotification('warning', 'Peringatan', 'Pilih setlist dulu');
        return;
    }
    
    if(!showDate){
        showDate = getTodayDate();
    }
    
    if(!showTime){
        showTime = '19:00:00';
    } else {
        if (showTime.length === 5) {
            showTime = showTime + ':00';
        }
    }
    
    if(!namesInput.trim()){
        showNotification('warning', 'Peringatan', 'Masukkan nama member');
        return;
    }
    
    var names=namesInput.split(',').map(function(n){return n.trim()}).filter(function(n){return n.length>0});
    
    if(names.length===0){
        showNotification('warning', 'Peringatan', 'Tidak ada nama yang valid');
        return;
    }
    
    if (isBirthdayShow && isGraduationShow) {
        showNotification('error', 'Konflik', 'Birthday & Graduation tidak bisa bersamaan');
        return;
    }
    
    var successCount=0;
    var failedNames=[];
    
    showNotification('info', 'Processing', 'Memproses '+names.length+' member...', 2000);
    
    var bulkData = [];
    
    for(var i=0;i<names.length;i++){
        var name=names[i];
        var member=members.find(function(m){return m.name.toLowerCase()===name.toLowerCase()});
        
        if(!member){
            failedNames.push(name+' (tidak ditemukan)');
            continue;
        }
        
        if(member.status === 'graduated'){
            failedNames.push(name+' (sudah graduated)');
            continue;
        }
        
        // Determine if this member is the graduation member
        var isThisGraduation = isGraduationShow && 
                              graduationMember.toLowerCase() === member.name.toLowerCase();
        
        var showData = {
            member_id: member.id,
            setlist_name: setlist,
            show_date: showDate,
            show_time: showTime,
            is_birthday_show: isBirthdayShow,
            birthday_member: isBirthdayShow ? birthdayMember : null,
            is_graduation_show: isThisGraduation,
            graduation_member: isThisGraduation ? graduationMember : null,
            is_non_show: isNonShow,
            created_at: new Date().toISOString()
        };
        
        bulkData.push(showData);
        successCount++;
    }
    
    if (bulkData.length === 0) {
        showNotification('error', 'Bulk Add', 'Tidak ada data valid');
        return;
    }
    
    try {
        // Insert semua data sekaligus
        var insertResult = await db.from('setlist_performance')
            .insert(bulkData)
            .select();
        
        if(insertResult.error){
            console.error('Bulk insert error:', insertResult.error);
            showNotification('error', 'Bulk Insert Error', 'Gagal insert bulk data: ' + insertResult.error.message);
            return;
        }
        
        // Reload data members
        await loadData();
        
        // Add activity logs untuk yang berhasil
        bulkData.forEach(function(showData) {
            var member = members.find(function(m) { return m.id === showData.member_id });
            if (member) {
                var activityText = setlist;
                if (showData.is_graduation_show) {
                    activityText += ' (LAST SHOW - ' + showData.graduation_member + ')';
                } else if (showData.is_birthday_show) {
                    activityText += ' (STS ' + showData.birthday_member + ')';
                }
                addActivity(member.name, 1, member.show, activityText, member.status);
            }
        });

        // Add activity logs untuk yang GAGAL
        failedNames.forEach(function(failedEntry) {
            addActivityFailed(failedEntry);
        });
        
        closeBulkAddModal();
        
        var toastDateInfo = formatDate(showDate)+' '+formatTime(showTime);
        var toastBirthdayInfo = isBirthdayShow ? ' (STS ' + birthdayMember + ')' : '';
        var toastGraduationInfo = isGraduationShow ? ' (LAST SHOW - ' + graduationMember + ')' : '';
        
        var message = '';
        if (isNonShow) {
            message = ''+successCount+' member berhasil ditambahkan sebagai Non-Show Activity! ('+toastDateInfo+') â€” Show count TIDAK bertambah';
            showNotification('success', 'Non-Show Activity Added', message);
        } else if (isGraduationShow) {
            message = ''+successCount+' member berhasil! ' + graduationMember + ' telah GRADUATED!'+toastBirthdayInfo+' ('+toastDateInfo+')';
            showNotification('success', 'Success', message);
        } else {
            message = ''+successCount+' member berhasil ditambahkan!'+toastBirthdayInfo+toastGraduationInfo+' ('+toastDateInfo+')';
            showNotification('success', 'Success', message);
        }
        
    } catch(err) {
        console.error('Bulk add exception:', err);
        showNotification('error', 'Bulk Add Error', 'Error: ' + err.message);
    }
}

async function updateShow(id, change){
    var member = members.find(function(m) { return m.id === id });
    if (!member) return;
    
    if(member.status === 'graduated'){
        showNotification('warning', 'Graduated', member.name+' sudah graduated');
        return;
    }
    
    // Cari show terakhir untuk member ini
    var setlistResult = await db.from('setlist_performance')
        .select('*')
        .eq('member_id', member.id)
        .order('created_at', { ascending: false })
        .limit(1);
    
    var lastSetlist = null;
    if (setlistResult.data && setlistResult.data.length > 0) {
        lastSetlist = setlistResult.data[0];
        
        if (lastSetlist.is_graduation_show && change < 0) {
            showNotification('error', 'Graduation', 'Show graduation tidak bisa dikurangi');
            return;
        }
        
        // Cek apakah tanggal show sudah lewat
        if (change < 0 && lastSetlist.show_date) {
            var showDateObj = new Date(lastSetlist.show_date + 'T00:00:00');
            var today = new Date();
            today.setHours(0, 0, 0, 0);
            if (showDateObj < today) {
                showNotification('error', 'Tanggal Sudah Lewat', 'Show tanggal ' + formatDate(lastSetlist.show_date) + ' sudah lewat, tidak bisa dikurangi');
                return;
            }
        }
    }
    
    if (change < 0) {
        showConfirmToast(
            member,
            lastSetlist,
            async function() {
                await doRemoveShow(member, lastSetlist);
            }
        );
        return;
    }
    
    if (change > 0) {
        openSetlistModal(member.id);
    }
}

function showConfirmToast(member, lastSetlist, onConfirm) {
    var modal = document.getElementById('confirmDeleteModal');
    var desc = document.getElementById('confirmDeleteDesc');
    var btn = document.getElementById('confirmDeleteBtn');

    var detailHtml = '';
    if (lastSetlist) {
        var tgl = lastSetlist.show_date ? formatDate(lastSetlist.show_date) : '-';
        var jam = lastSetlist.show_time ? formatTime(lastSetlist.show_time) : '-';
        var setlist = lastSetlist.setlist_name || '-';
        var extra = '';
        if (lastSetlist.is_birthday_show) extra = ' <span style="background:#fef3c7;color:#92400e;font-size:10px;font-weight:700;padding:2px 7px;border-radius:10px;">STS ' + (lastSetlist.birthday_member || '') + '</span>';
        if (lastSetlist.is_graduation_show) extra = ' <span style="background:#ede9fe;color:#5b21b6;font-size:10px;font-weight:700;padding:2px 7px;border-radius:10px;">LAST SHOW</span>';
        if (lastSetlist.is_non_show) extra = ' <span style="background:#dcfce7;color:#166534;font-size:10px;font-weight:700;padding:2px 7px;border-radius:10px;">NON-SHOW</span>';

        // Cek apakah show sudah lewat
        var showPassed = false;
        if (lastSetlist.show_date && lastSetlist.show_time) {
            var showDateTime = new Date(lastSetlist.show_date + 'T' + lastSetlist.show_time);
            showPassed = showDateTime < new Date();
        } else if (lastSetlist.show_date) {
            showPassed = new Date(lastSetlist.show_date) < new Date();
        }

        var liveshowParams = 'liveshow.html?setlist=' + encodeURIComponent(lastSetlist.setlist_name || '') +
            '&date=' + encodeURIComponent(lastSetlist.show_date || '') +
            '&time=' + encodeURIComponent(lastSetlist.show_time || '') +
            '&source=admin';

        var liveshowLink = showPassed ? '' :
            '<a href="' + liveshowParams + '" target="_blank" style="display:flex;align-items:center;justify-content:center;gap:6px;margin-top:12px;padding:9px;background:#e60012;color:#fff;border-radius:10px;font-size:13px;font-weight:700;text-decoration:none;">' +
                '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/></svg>' +
                'Lihat Live Show' +
            '</a>';

        detailHtml =
            '<div style="background:#f9fafb;border-radius:12px;padding:14px 16px;margin:14px 0 20px;text-align:left;border:1px solid #e5e7eb;">' +
                '<div style="font-size:11px;color:#9ca3af;font-weight:600;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:10px;">Detail Show Terakhir</div>' +
                '<div style="display:flex;flex-direction:column;gap:8px;">' +
                    '<div style="display:flex;align-items:center;gap:8px;font-size:13px;">' +
                        '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>' +
                        '<span style="color:#6b7280;">Member</span>' +
                        '<span style="font-weight:700;color:#111;margin-left:auto;">' + member.name + '</span>' +
                    '</div>' +
                    '<div style="display:flex;align-items:center;gap:8px;font-size:13px;">' +
                        '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>' +
                        '<span style="color:#6b7280;">Tanggal</span>' +
                        '<span style="font-weight:700;color:#111;margin-left:auto;">' + tgl + '</span>' +
                    '</div>' +
                    '<div style="display:flex;align-items:center;gap:8px;font-size:13px;">' +
                        '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>' +
                        '<span style="color:#6b7280;">Jam</span>' +
                        '<span style="font-weight:700;color:#111;margin-left:auto;">' + jam + '</span>' +
                    '</div>' +
                    '<div style="display:flex;align-items:center;gap:8px;font-size:13px;">' +
                        '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>' +
                        '<span style="color:#6b7280;">Setlist</span>' +
                        '<span style="font-weight:700;color:#111;margin-left:auto;">' + setlist + extra + '</span>' +
                    '</div>' +
                '</div>' +
                liveshowLink +
            '</div>';
    } else {
        detailHtml = '<p style="font-size:13px;color:#6b7280;margin:12px 0 20px;">Tidak ada data show yang bisa dihapus.</p>';
    }

    desc.innerHTML = detailHtml;
    modal.style.display = 'flex';

    var newBtn = document.getElementById('confirmDeleteBtn');
    var clone = newBtn.cloneNode(true);
    newBtn.parentNode.replaceChild(clone, newBtn);
    document.getElementById('confirmDeleteBtn').onclick = function() {
        closeConfirmDeleteModal();
        onConfirm();
    };
}

function closeConfirmDeleteModal() {
    document.getElementById('confirmDeleteModal').style.display = 'none';
}

function dismissConfirmToast() { closeConfirmDeleteModal(); }

async function doRemoveShow(member, lastSetlist) {
    try {
        if (lastSetlist) {
            await db.from('setlist_performance')
                .delete()
                .eq('id', lastSetlist.id);
            console.log('ðŸ—‘ï¸ Record dihapus (ID: '+lastSetlist.id+')');
            await loadData();
            var activityText = lastSetlist.setlist_name;
            if (lastSetlist.is_graduation_show) activityText += ' (LAST SHOW)';
            else if (lastSetlist.is_birthday_show) activityText += ' (STS ' + lastSetlist.birthday_member + ')';
            addActivity(member.name, -1, member.show, activityText, member.status);
            showNotification('success', 'Dihapus', member.name + ': show dikurangi');
        }
    } catch (err) {
        console.error('Update error:', err);
        showNotification('error', 'Update Error', 'Gagal update: ' + err.message);
    }
}

// =================== EDIT SHOW FUNCTIONS ===================

async function openEditShow(showId) {
    currentEditShowId = showId;
    
    try {
        // Ambil data show dari database
        var result = await db.from('setlist_performance')
            .select('*, members(name, status)')
            .eq('id', showId)
            .single();
        
        if (result.error) {
            throw result.error;
        }
        
        currentEditShowData = result.data;
        
        // Cek apakah show sudah lewat
        var showDateTime = new Date(currentEditShowData.show_date + 'T' + currentEditShowData.show_time);
        var now = new Date();
        
        if (now > showDateTime) {
            showNotification('warning', 'Sudah Lewat', 'Show ini tidak bisa diedit');
            return;
        }
        
        // Tampilkan info original
        var originalInfo = 'Mengedit show untuk ' + 
                          (currentEditShowData.members ? currentEditShowData.members.name : 'Unknown') + 
                          ' pada ' + formatDate(currentEditShowData.show_date) + 
                          ' ' + formatTime(currentEditShowData.show_time);
        document.getElementById('editShowOriginalInfo').textContent = originalInfo;
        
        // Load dropdown member
        var memberSelect = document.getElementById('editMemberSelect');
        memberSelect.innerHTML = '<option value="">-- Pilih Member --</option>';
        
        members.forEach(function(member) {
            var selected = (member.id === currentEditShowData.member_id) ? 'selected' : '';
            memberSelect.innerHTML += '<option value="' + member.id + '" ' + selected + '>' + member.name + '</option>';
        });
        
        // Set tanggal dan waktu
        document.getElementById('editShowDate').value = currentEditShowData.show_date;
        
        var timeValue = currentEditShowData.show_time;
        if (timeValue && timeValue.length >= 5) {
            document.getElementById('editShowTime').value = timeValue.substring(0, 5);
        } else {
            document.getElementById('editShowTime').value = '19:00';
        }
        
        // Load setlist dropdown
        var setlistSelect = document.getElementById('editSetlistSelect');
        setlistSelect.innerHTML = '<option value="">Pilih Setlist...</option>';
        
        // Tambahkan opsi kustom setlist
        setlistSelect.innerHTML += '<option value="__custom__">Kustom Setlist (Ketik Manual)</option>';
        
        // Tentukan setlist berdasarkan member yang dipilih (bukan berdasarkan data lama)
        var currentMember = members.find(function(m) { return m.id === currentEditShowData.member_id });
        var setlists = (currentMember && currentMember.status === 'trainee') ? SETLIST_TRAINEE : SETLIST_INTI;
        
        for(var key in setlists){
            var selected = (key === currentEditShowData.setlist_name) ? 'selected' : '';
            setlistSelect.innerHTML += '<option value="' + key + '" ' + selected + '>' + key + '</option>';
        }
        
        // Reset custom field
        document.getElementById('editCustomSetlistField').classList.remove('show');
        document.getElementById('editCustomSetlistName').value = '';
        
        // Jika setlist adalah custom (tidak ada di daftar), maka set ke custom dan isi field
        var isCustomSetlist = true;
        for(var key in setlists) {
            if (key === currentEditShowData.setlist_name) {
                isCustomSetlist = false;
                break;
            }
        }
        
        if (isCustomSetlist && currentEditShowData.setlist_name) {
            setlistSelect.value = '__custom__';
            document.getElementById('editCustomSetlistField').classList.add('show');
            document.getElementById('editCustomSetlistName').value = currentEditShowData.setlist_name;
        } else {
            setlistSelect.value = currentEditShowData.setlist_name;
        }
        
        // Set birthday checkbox
        var isBirthday = currentEditShowData.is_birthday_show;
        document.getElementById('editIsBirthdayShow').checked = isBirthday;
        if (isBirthday) {
            document.getElementById('editBirthdayMemberField').classList.add('show');
            populateMemberDropdown('editBirthdayMember');
            document.getElementById('editBirthdayMember').value = currentEditShowData.birthday_member || '';
        } else {
            document.getElementById('editBirthdayMemberField').classList.remove('show');
        }
        
        // Set graduation checkbox
        var isGraduation = currentEditShowData.is_graduation_show;
        document.getElementById('editIsGraduationShow').checked = isGraduation;
        if (isGraduation) {
            document.getElementById('editGraduationMemberField').classList.add('show');
            populateMemberDropdown('editGraduationMember');
            document.getElementById('editGraduationMember').value = currentEditShowData.graduation_member || '';
        } else {
            document.getElementById('editGraduationMemberField').classList.remove('show');
        }
        
        document.getElementById('editShowModal').style.display = 'flex';
        
    } catch (err) {
        console.error('Error loading show data:', err);
        showNotification('error', 'Edit Error', 'Gagal memuat data show: ' + err.message);
    }
}

function closeEditShowModal() {
    document.getElementById('editShowModal').style.display = 'none';
    currentEditShowId = null;
    currentEditShowData = null;
}

async function saveEditShow() {
    var memberId = document.getElementById('editMemberSelect').value;
    var showDate = document.getElementById('editShowDate').value;
    var showTime = document.getElementById('editShowTime').value;
    
    // Dapatkan setlist (bisa dari pilihan atau custom)
    var setlist = getSelectedSetlist('editSetlistSelect', 'editCustomSetlistName');
    if (!setlist) return; // Error sudah ditampilkan di getSelectedSetlist
    
    var isBirthdayShow = document.getElementById('editIsBirthdayShow').checked;
    var birthdayMember = document.getElementById('editBirthdayMember').value;
    var isGraduationShow = document.getElementById('editIsGraduationShow').checked;
    var graduationMember = document.getElementById('editGraduationMember').value;
    
    // Validasi
    if (!memberId) {
        showNotification('warning', 'Validasi', 'Pilih member dulu');
        return;
    }
    
    if (!setlist) {
        showNotification('warning', 'Validasi', 'Pilih setlist dulu');
        return;
    }
    
    if (!showDate) {
        showNotification('warning', 'Validasi', 'Masukkan tanggal show');
        return;
    }
    
    if (isBirthdayShow && !birthdayMember) {
        showNotification('warning', 'Validasi', 'Pilih member birthday');
        return;
    }
    
    if (isGraduationShow && !graduationMember) {
        showNotification('warning', 'Validasi', 'Pilih member graduation');
        return;
    }
    
    if (isBirthdayShow && isGraduationShow) {
        showNotification('warning', 'Konflik', 'Birthday & Graduation tidak bisa bersamaan');
        return;
    }
    
    // Cek apakah member yang dipilih sama dengan graduation member
    var selectedMember = members.find(function(m) { return m.id == memberId });
    if (isGraduationShow && selectedMember && graduationMember !== selectedMember.name) {
        showNotification('warning', 'Validasi', 'Graduation hanya untuk member ini');
        return;
    }
    
    // Validasi tanggal show tidak boleh diubah ke waktu yang sudah lewat
    var newShowDateTime = new Date(showDate + 'T' + (showTime.length === 5 ? showTime + ':00' : showTime));
    var now = new Date();
    
    if (newShowDateTime < now) {
        showNotification('warning', 'Validasi', 'Tidak bisa ubah ke waktu yang sudah lewat');
        return;
    }
    
    try {
        var updateData = {
            member_id: memberId,
            setlist_name: setlist,
            show_date: showDate,
            show_time: showTime + ':00', // Tambah detik
            is_birthday_show: isBirthdayShow,
            birthday_member: isBirthdayShow ? birthdayMember : null,
            is_graduation_show: isGraduationShow,
            graduation_member: isGraduationShow ? graduationMember : null,
            updated_at: new Date().toISOString()
        };
        
        var updateResult = await db.from('setlist_performance')
            .update(updateData)
            .eq('id', currentEditShowId)
            .select();
        
        if (updateResult.error) {
            throw updateResult.error;
        }
        
        // Reload semua data
        await loadData();
        
        // Tampilkan notifikasi sukses
        var oldMemberName = currentEditShowData.members ? currentEditShowData.members.name : 'Unknown';
        var newMemberName = selectedMember ? selectedMember.name : 'Unknown';
        
        var message = 'Show berhasil diupdate: ' + oldMemberName + ' â†’ ' + newMemberName + 
                     ' (' + setlist + ' - ' + formatDate(showDate) + ' ' + formatTime(showTime) + ')';
        
        if (isGraduationShow) {
            message = '' + newMemberName + ' graduation show berhasil diupdate!';
        }
        
        showNotification('success', 'Edit Success', message);
        
        // Tutup modal
        closeEditShowModal();
        
    } catch (err) {
        console.error('Error updating show:', err);
        showNotification('error', 'Edit Error', 'Gagal update show: ' + err.message);
    }
}

// =================== OTHER FUNCTIONS ===================

function updateStats(){
    var filtered=members.filter(function(m){
        var matchGen=currentGen==='all'||m.gen==currentGen;
        var matchStatus=currentStatus==='all'||m.status===currentStatus;
        var matchSearch=!searchQuery||m.name.toLowerCase().includes(searchQuery.toLowerCase());
        return matchGen&&matchStatus&&matchSearch;
    });
    
    var total=filtered.length;
    var trainee=filtered.filter(function(m){return m.status==='trainee'}).length;
    var inti=filtered.filter(function(m){return m.status==='inti'}).length;
    var graduated=filtered.filter(function(m){return m.status==='graduated'}).length;
    var totalShows=filtered.reduce(function(sum,m){return sum+m.show},0);
    
    var statsText=total+' members â€¢ '+inti+' Inti â€¢ '+trainee+' Trainee â€¢ '+graduated+' Graduated â€¢ '+totalShows+' total show';
    if(currentGen!=='all') statsText+=' â€¢ Gen '+currentGen;
    if(currentStatus!=='all') statsText+=' â€¢ '+currentStatus.toUpperCase();
    if(searchQuery) statsText+=' â€¢ Search: "'+searchQuery+'"';
    
    document.getElementById('stats').innerHTML=statsText;
}

function filterType(status){
    currentStatus = status;
    currentGen = 'all';
    document.querySelectorAll('.filter').forEach(function(f) {
        f.classList.remove('active');
    });
    event.target.classList.add('active');
    renderMembers();
    updateStats();
}

function filterGen(gen){
    currentGen = gen;
    currentStatus = 'all';
    document.querySelectorAll('.filter').forEach(function(f) {
        f.classList.remove('active');
    });
    event.target.classList.add('active');
    renderMembers();
    updateStats();
}

function searchMember(){
    searchQuery=document.getElementById('searchInput').value.toLowerCase();
    renderMembers();
    updateStats();
}

function toggleClearBtn() {
    const btn = document.getElementById('searchClear');
    const icon = document.getElementById('searchIconSpan');
    const input = document.getElementById('searchInput');
    const hasValue = input.value.length > 0;
    if (btn) btn.classList.toggle('visible', hasValue);
    if (icon) icon.classList.toggle('hidden', hasValue);
}

function clearSearch(){
    document.getElementById('searchInput').value='';
    searchQuery='';
    toggleClearBtn();
    renderMembers();
    updateStats();
    document.getElementById('searchInput').focus();
}

function login(){
    var email=document.getElementById('email').value.trim();
    var password=document.getElementById('password').value.trim();
    var error=document.getElementById('errorMsg');
    
    error.style.display='none';
    
    if(!email||!password){
        error.textContent='Email dan password harus diisi';
        error.style.display='block';
        return;
    }
    
    if(ADMIN_ACCOUNTS[email]===password){
        var loginTime=new Date().getTime();
        localStorage.setItem('jkt48_admin_email',email);
        localStorage.setItem('jkt48_admin_login_time',loginTime.toString());
        document.getElementById('loginModal').style.display='none';
        loadData();
        loadActivityLog();
        showNotification('success', 'Login', 'Berhasil masuk');
    }else{
        error.textContent='Email atau password salah';
        error.style.display='block';
        showNotification('error', 'Login', 'Email atau password salah');
    }
}

function logout(){
    document.getElementById('logoutModal').style.display='flex';
}

function closeLogoutModal(){
    document.getElementById('logoutModal').style.display='none';
}

function confirmLogout(){
    localStorage.removeItem('jkt48_admin_email');
    localStorage.removeItem('jkt48_admin_login_time');
    closeLogoutModal();
    document.getElementById('loginModal').style.display='flex';
    showNotification('info', 'Logout', 'Berhasil keluar');
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    if(savedTheme==='dark'){
        document.body.classList.add('dark');
    }
    
    // Fetch stats for login panel even before login
    if (_needLogin) {
        db.from('members').select('status,gen').then(function(result){
            if (!result.error && result.data) {
                var active = result.data.filter(function(m){ return m.status !== 'graduated'; }).length;
                var elM = document.getElementById('loginStatMembers');
                var elG = document.getElementById('loginStatGen');
                if (elM) elM.textContent = active;
                if (elG) elG.textContent = '14';
            }
        });
    }
    
    // Splash animation logic
    var splash = document.getElementById('loginSplash');
    var loginModal = document.getElementById('loginModal');
    
    if (!_needLogin) {
        // Already logged in: hide splash quickly
        setTimeout(function() {
            splash.classList.add('hiding');
            setTimeout(function() { splash.style.display = 'none'; }, 500);
        }, 1200);
    } else {
        // Not logged in: show splash then reveal login
        setTimeout(function() {
            splash.classList.add('hiding');
            setTimeout(function() {
                splash.style.display = 'none';
                loginModal.style.display = 'flex';
                loginModal.classList.add('animate-in');
            }, 500);
        }, 3500);
    }
});
</script>
<footer style="text-align:center;padding:12px;color:#6b7280;font-size:10px;border-top:1px solid #e5e7eb;margin-top:20px">Â© 2026 Show Theater. Data diperbarui secara real-time</footer>
</body>
</html>
