<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jadwal Show - JKT48 Show Theater</title>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial,sans-serif;background:#f5f5f5;color:#333;min-height:100vh;padding:0;transition:background 0.3s,color 0.3s}
body.dark{background:#0a0e1a;color:#e5e7eb}

.main-header{position:fixed;top:0;left:0;right:0;background:#fff;z-index:1001;border-bottom:1px solid #ddd;transition:background 0.3s,border-color 0.3s}
body.dark .main-header{background:#111827;border-color:#1f2937}

.theater-header{text-align:center;padding:10px 20px;font-size:14px;font-weight:bold;color:#333;letter-spacing:1px}
body.dark .theater-header{color:#e5e7eb}

.detail-header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:12px 20px;
    background:#fff;
    border-top:1px solid #eee;
    border-bottom:1px solid #ddd;
    transition:background 0.3s,border-color 0.3s;
}
body.dark .detail-header{
    background:#111827;
    border-color:#1f2937;
}

.back-btn{
    background:transparent;
    border:none;
    color:#333;
    font-size:16px;
    font-weight:600;
    cursor:pointer;
    display:flex;
    align-items:center;
    gap:6px;
    padding:8px 0;
    transition:all 0.3s;
}
body.dark .back-btn{color:#e5e7eb}
.back-btn:hover{opacity:0.7}

.detail-title{
    font-size:16px;
    font-weight:bold;
    color:#333;
    text-align:center;
    flex:1;
    margin:0 10px;
}
body.dark .detail-title{color:#e5e7eb}

.header-controls{
    display:flex;
    align-items:center;
    gap:10px;
}

.theme-toggle-detail{
    background:#e60012;
    border:none;
    width:40px;
    height:40px;
    border-radius:50%;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:8px;
    transition:all 0.3s;
}
.theme-toggle-detail:hover{
    background:#d5000f;
    transform:scale(1.1);
}
.theme-toggle-detail svg{
    width:100%;
    height:100%;
    color:#fff;
}

.container{
    max-width:480px;
    width:100%;
    margin:120px auto 30px;
    background:transparent;
    border-radius:0;
    overflow:visible;
    box-shadow:none;
}

.member-info{
    padding:20px;
    text-align:center;
    border-bottom:1px solid #e5e7eb;
}
body.dark .member-info{
    border-bottom-color:#374151;
}

.photo-container{
    text-align:center;
    margin:18px 0;
    position:relative;
}

.photo{
    width:135px;
    height:190px;
    object-fit:contain;
    border-radius:0;
    transition:all 0.3s;
}
body.dark .photo{
    background:#1a1a1a;
}

.photo-error{
    width:135px;
    height:190px;
    border-radius:0;
    display:flex;
    align-items:center;
    justify-content:center;
    background:#f5f5f5;
    color:#6b7280;
    font-weight:600;
    font-size:24px;
}
body.dark .photo-error{
    background:#1a1a1a;
    color:#9ca3af;
}

.member-name{
    font-size:22px;
    font-weight:bold;
    color:#333;
    margin-bottom:15px;
}
body.dark .member-name{color:#e5e7eb}

.member-stats{
    display:flex;
    justify-content:center;
    gap:40px;
}

.stat-item{
    text-align:center;
}

.stat-number{
    font-size:28px;
    font-weight:bold;
    color:var(--gen-color);
}

.stat-label{
    font-size:12px;
    color:#6b7280;
    font-weight:600;
    margin-top:5px;
}
body.dark .stat-label{color:#9ca3af}

.header{
    background:linear-gradient(135deg,var(--gen-color),var(--gen-color-dark));
    padding:18px;
    text-align:center;
    position:relative;
}
.header h1{
    font-size:16px;
    margin:0;
    color:#fff;
    font-weight:600;
}

.filter-section{
    padding:15px 20px;
    background:#f9fafb;
    border-bottom:1px solid #e5e7eb;
    display:flex;
    gap:10px;
    overflow-x:auto;
}
body.dark .filter-section{
    background:#1f2937;
    border-bottom-color:#374151;
}
.filter-section::-webkit-scrollbar{display:none}

.filter-btn{
    padding:10px 18px;
    border-radius:20px;
    border:2px solid #e5e7eb;
    background:#fff;
    color:#6b7280;
    font-size:13px;
    font-weight:600;
    cursor:pointer;
    white-space:nowrap;
    transition:all 0.3s;
}
body.dark .filter-btn{
    background:#111827;
    border-color:#374151;
    color:#9ca3af;
}
.filter-btn.active{
    background:var(--gen-color);
    color:#fff;
    border-color:var(--gen-color);
}
.filter-btn:hover{
    background:var(--gen-color);
    color:#fff;
    border-color:var(--gen-color);
}

.content{padding:20px}

.show-list{
    display:flex;
    flex-direction:column;
    gap:15px;
}

.show-card{
    background:#f9fafb;
    border:1px solid #e5e7eb;
    border-radius:12px;
    padding:18px;
    transition:all 0.3s;
    cursor:pointer;
}
body.dark .show-card{
    background:#1f2937;
    border-color:#374151;
}
.show-card:hover{
    border-color:var(--gen-color);
}
.show-card.live-now{
    border:2px solid #ef4444;
    background:#fff5f5;
    animation:pulse-live 2s infinite;
}
body.dark .show-card.live-now{
    background:#1f1515;
}
@keyframes pulse-live{
    0%,100%{opacity:1}
    50%{opacity:0.9}
}

.show-header{
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    margin-bottom:12px;
    gap:10px;
}

.show-date{
    font-size:15px;
    font-weight:bold;
    color:#333;
}
body.dark .show-date{color:#e5e7eb}

.show-time{
    display:flex;
    align-items:center;
    gap:6px;
    font-size:13px;
    color:#6b7280;
    margin-top:5px;
    font-weight:500;
}
body.dark .show-time{color:#9ca3af}
.show-time svg{width:14px;height:14px}

.show-badge{
    background:var(--gen-color);
    color:#fff;
    padding:5px 12px;
    border-radius:15px;
    font-size:11px;
    font-weight:bold;
    white-space:nowrap;
}

.live-badge{
    background:#ef4444;
    color:#fff;
    padding:6px 12px;
    border-radius:15px;
    font-size:11px;
    font-weight:bold;
    display:inline-flex;
    align-items:center;
    gap:5px;
    animation:pulse 2s infinite;
    white-space:nowrap;
}
@keyframes pulse{
    0%,100%{opacity:1}
    50%{opacity:0.7}
}

.live-dot{
    width:6px;
    height:6px;
    background:#fff;
    border-radius:50%;
    animation:blink 1s infinite;
}
@keyframes blink{
    0%,100%{opacity:1}
    50%{opacity:0.3}
}

.sts-badge{
    background:#f59e0b;
    color:#fff;
    padding:6px 12px;
    border-radius:15px;
    font-size:11px;
    font-weight:bold;
    display:inline-flex;
    align-items:center;
    gap:4px;
    white-space:nowrap;
}

.lastshow-badge{
    background:#1e40af;
    color:#fff;
    padding:6px 12px;
    border-radius:15px;
    font-size:11px;
    font-weight:bold;
    display:inline-flex;
    align-items:center;
    gap:4px;
    white-space:nowrap;
    animation:graduation-pulse 2s infinite;
}

@keyframes graduation-pulse {
    0%, 100% { 
        opacity: 1;
        box-shadow: 0 0 8px rgba(30, 64, 175, 0.4);
    }
    50% { 
        opacity: 0.8;
        box-shadow: 0 0 12px rgba(30, 64, 175, 0.6);
    }
}

.badge-container{
    display:flex;
    gap:6px;
    align-items:center;
    flex-wrap:wrap;
    justify-content:flex-end;
}

.show-setlist{
    font-size:14px;
    color:#6b7280;
    margin-bottom:8px;
    font-weight:600;
}
body.dark .show-setlist{color:#9ca3af}

.empty-state{
    text-align:center;
    padding:60px 20px;
    color:#6b7280;
}
body.dark .empty-state{color:#9ca3af}

.empty-icon{
    font-size:64px;
    margin-bottom:15px;
    opacity:0.5;
}

.empty-title{
    font-size:16px;
    font-weight:bold;
    margin-bottom:8px;
}

.empty-desc{
    font-size:13px;
    line-height:1.5;
}

.loading{
    text-align:center;
    padding:80px 20px;
    color:#6b7280;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:8px;
}

@keyframes spin{
    to{transform:rotate(360deg)}
}

.spinner{
    display:inline-block;
    width:20px;
    height:20px;
    border:3px solid rgba(0,0,0,0.1);
    border-top-color:#9ca3af;
    border-radius:50%;
    animation:spin 0.8s linear infinite;
}
body.dark .spinner{
    border-color:rgba(255,255,255,0.1);
    border-top-color:#9ca3af;
}

.detail-footer{
    text-align:center;
    padding:12px;
    color:#6b7280;
    font-size:10px;
    border-top:1px solid #e5e7eb;
    margin-top:12px;
}
body.dark .detail-footer{
    color:#9ca3af;
    border-top-color:#374151;
}

.skeleton-loading{
    padding:20px;
    animation:skeleton-pulse 1.5s ease-in-out infinite;
}
@keyframes skeleton-pulse{
    0%,100%{opacity:1}
    50%{opacity:0.5}
}

.skeleton-card{
    width:100%;
    height:110px;
    background:#e5e7eb;
    border-radius:12px;
    margin-bottom:15px;
}
body.dark .skeleton-card{background:#374151}

@media (max-width:480px){
    .container{
        max-width:100%;
        margin:120px 0 15px;
        border-radius:0;
    }
    .member-info{padding:16px}
    .photo,.photo-error{
        width:120px;
        height:170px;
        border-radius:0;
    }
    .member-name{
        font-size:20px;
        margin-bottom:12px;
    }
    .member-stats{gap:20px;flex-wrap:wrap}
    .stat-number{font-size:24px}
    .stat-label{font-size:11px}
    .filter-section{padding:12px 16px}
    .filter-btn{padding:8px 14px;font-size:12px}
    .content{padding:16px}
    .show-card{padding:15px}
    .show-date{font-size:14px}
    .show-time{font-size:12px}
    .show-setlist{font-size:13px}
}

@media (min-width: 1025px) {
    .main-header {
        position: relative;
        background: #fff;
        border-bottom: 1px solid #ddd;
        margin-bottom: 30px;
    }
    
    .theater-header {
        color: #333;
        font-size: 16px;
        padding: 12px 20px;
        letter-spacing: 1px;
    }
    
    .detail-header {
        background: #fff;
        border-top: none;
        border-bottom: 1px solid #ddd;
    }
    
    body.dark .main-header {
        background: #111827;
        border-color: #1f2937;
    }
    
    body.dark .theater-header {
        color: #e5e7eb;
    }
    
    body.dark .detail-header {
        background: #111827;
        border-color: #1f2937;
    }
    
    .container {
        max-width: 1200px;
        margin: 0 auto 40px;
        display: flex;
        border-radius: 0;
        background: transparent;
        box-shadow: none;
        min-height: 600px;
    }
    
    .header {
        display: none;
    }
    
    /* Left Side - Member Info */
    .member-info {
        flex: 0 0 300px;
        border-bottom: none;
        border-right: 1px solid #e5e7eb;
        padding: 30px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
    }
    
    body.dark .member-info {
        border-right-color: #374151;
    }
    
    .photo-container {
        margin: 0 0 25px 0;
    }
    
    .photo, .photo-error {
        width: 200px;
        height: 280px;
    }
    
    .member-name {
        font-size: 26px;
        margin-bottom: 25px;
    }
    
    .member-stats {
        gap: 50px;
        margin-top: 20px;
    }
    
    .stat-number {
        font-size: 32px;
    }
    
    .stat-label {
        font-size: 14px;
    }
    
    .content {
        padding: 30px;
        overflow-y: auto;
    }
    
    .filter-section {
        padding: 20px 0;
        border-bottom: 1px solid #e5e7eb;
        margin-bottom: 25px;
        background: transparent;
        position: sticky;
        top: 0;
        z-index: 10;
    }
    
    body.dark .filter-section {
        border-bottom-color: #374151;
        background: transparent;
    }
    
    .filter-btn {
        padding: 12px 20px;
        font-size: 14px;
    }
    
    .show-list {
        gap: 20px;
    }
    
    .show-card {
        padding: 22px;
    }
    
    .show-date {
        font-size: 17px;
    }
    
    .show-time {
        font-size: 14px;
    }
    
    .show-time svg {
        width: 16px;
        height: 16px;
    }
    
    .show-setlist {
        font-size: 16px;
    }
    
    .show-badge {
        font-size: 12px;
        padding: 6px 14px;
    }
    
    .live-badge {
        font-size: 12px;
        padding: 8px 14px;
    }
    
    .sts-badge,
    .lastshow-badge {
        font-size: 12px;
        padding: 8px 14px;
    }
    
    .live-dot {
        width: 8px;
        height: 8px;
    }
    
    .detail-footer {
        padding: 20px;
        font-size: 12px;
        max-width: 1200px;
        margin: 0 auto;
        border: none;
        border-top: 1px solid #e5e7eb;
        margin-top: 40px;
    }
    
    body.dark .detail-footer {
        border-top-color: #374151;
    }
    
    .skeleton-loading {
        padding: 30px;
    }
    
    .skeleton-card {
        height: 120px;
    }
}
</style>
</head>
<body>
<header class="main-header">
  <div class="theater-header">JKT48 SHOW THEATER</div>
  <div class="detail-header">
    <button onclick="goBack()" class="back-btn">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      Kembali
    </button>
    <div class="detail-title">Riwayat Show</div>
    <div class="header-controls">
      <button class="theme-toggle-detail" onclick="toggleTheme()">
        <svg id="themeIconDetail" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"/>
        </svg>
      </button>
    </div>
  </div>
</header>

<div class="container" id="container">
  <div class="skeleton-loading">
    <div class="skeleton-card"></div>
    <div class="skeleton-card"></div>
    <div class="skeleton-card"></div>
  </div>
</div>

<footer class="detail-footer">
  <p>JKT48 Show Theater â€¢ Data diperbarui secara real-time</p>
</footer>

<script>
const SUPABASE_URL = "https://pprxfopqkvpeajeoxzig.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBwcnhmb3Bxa3ZwZWFqZW94emlnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyNTI4MTIsImV4cCI6MjA4MTgyODgxMn0.iXRO_dAHhtVHRLqGTresG_63RD2zIaopNXtXYNfthdg";

const urlParams = new URLSearchParams(window.location.search);
const MEMBER_NAME = urlParams.get('member');

const db = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const GEN_COLORS = {
  3: '#ec4899', 6: '#22c55e', 7: '#15803d', 8: '#1e40af',
  9: '#06b6d4', 10: '#38bdf8', 11: '#f97316', 12: '#fde68a',
  13: '#facc15', 14: '#e879f9'
};

const LIVE_CONFIG = {
    BEFORE_MINUTES: 15,
    DURATION_MINUTES: 155
};

(function initializeTheme() {
  const savedTheme = localStorage.getItem('jkt48_theme') || 'light';
  const html = document.documentElement;
  const body = document.body;
  
  if (savedTheme === 'dark') {
    html.classList.add('dark');
    body.classList.add('dark');
    updateThemeIcon('dark');
  } else {
    html.classList.remove('dark');
    body.classList.remove('dark');
    updateThemeIcon('light');
  }
})();

function updateThemeIcon(theme) {
  const icon = document.getElementById('themeIconDetail');
  if (!icon) return;
  
  if (theme === 'dark') {
    icon.innerHTML = '<path d="M12,17a5,5,0,1,1,5-5A5,5,0,0,1,12,17Zm0-8a3,3,0,1,0,3,3A3,3,0,0,0,12,9Zm0-4a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41L6.34,5A1,1,0,0,0,4.93,6.34ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm.64,5.66a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71a1,1,0,0,0-1.41-1.41ZM12,19a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19Zm6.36-2.34a1,1,0,0,0-1.41,1.41l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-3.64-3.95a1,1,0,0,0,.7.29,1,1,0,0,0,.71-1.7l-.71-.71a1,1,0,0,0-1.41,1.41Z"/>';
  } else {
    icon.innerHTML = '<path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"/>';
  }
}

function toggleTheme() {
  const html = document.documentElement;
  const body = document.body;
  
  const isDark = body.classList.contains('dark');
  
  if (isDark) {
    html.classList.remove('dark');
    body.classList.remove('dark');
    localStorage.setItem('jkt48_theme', 'light');
    updateThemeIcon('light');
  } else {
    html.classList.add('dark');
    body.classList.add('dark');
    localStorage.setItem('jkt48_theme', 'dark');
    updateThemeIcon('dark');
  }
}

function getLiveStatus(showDate, showTime) {
    if (!showDate || !showTime) return 'FINISHED';
    
    const now = new Date();
    const showDateTime = new Date(`${showDate}T${showTime}`);
    
    const liveStart = new Date(showDateTime.getTime() - (LIVE_CONFIG.BEFORE_MINUTES * 60 * 1000));
    const liveEnd = new Date(showDateTime.getTime() + (LIVE_CONFIG.DURATION_MINUTES * 60 * 1000));
    
    if (now < liveStart) return 'UPCOMING';
    if (now >= liveStart && now <= liveEnd) return 'LIVE';
    return 'FINISHED';
}

let memberData = null;
let showsData = [];
let currentFilter = 'all';

async function loadData() {
  if (!MEMBER_NAME) {
    showError('Parameter member tidak ditemukan');
    return;
  }

  try {
    const { data: member, error: memberError } = await db
      .from('members')
      .select('*')
      .eq('name', MEMBER_NAME)
      .single();

    if (memberError) {
      if (memberError.code === 'PGRST116') {
        showError('Member tidak ditemukan');
      } else {
        throw memberError;
      }
      return;
    }
    
    memberData = member;
    
    const { data: shows, error: showsError } = await db
      .from('setlist_performance')
      .select('*')
      .eq('member_id', member.id)
      .order('show_date', { ascending: false })
      .order('show_time', { ascending: false });

    if (showsError) throw showsError;
    
    showsData = shows || [];
    
    renderPage();
    
  } catch (err) {
    console.error('Error:', err);
    showError('Gagal memuat data. Coba refresh halaman.');
  }
}

function renderPage() {
  const color = GEN_COLORS[memberData.gen] || '#ec4899';
  const colorDark = adjustColor(color, -20);
  
  document.documentElement.style.setProperty('--gen-color', color);
  document.documentElement.style.setProperty('--gen-color-dark', colorDark);
  
  const setlists = [...new Set(showsData.map(s => s.setlist_name))];
  
  const graduationInfo = memberData.status === 'graduated' ? 
    `<div style="margin-top: 10px; padding: 8px 16px; background: #1e40af; color: white; border-radius: 12px; font-size: 12px; display: inline-flex; align-items: center; gap: 6px;">
      <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16">
        <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zM4.5 6.5a.5.5 0 0 1 0-1h5.793L8.146 4.354a.5.5 0 1 1 .708-.708l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708L10.293 7.5H4.5z"/>
      </svg>
      Graduated Member
    </div>` : '';
  
  document.getElementById('container').innerHTML = `
    <div class="member-info">
      <div class="photo-container">
        <img class="photo" 
             src="img/${memberData.name.toLowerCase()}.jpg" 
             loading="lazy"
             decoding="async"
             onerror="this.onerror=null; this.parentNode.innerHTML='<div class=\\'photo-error\\'>${memberData.name.charAt(0)}</div>';"
             alt="${memberData.name}">
      </div>
      <div class="member-name">${memberData.name}</div>
      ${graduationInfo}
      <div class="member-stats">
        <div class="stat-item">
          <div class="stat-number">${showsData.length}</div>
          <div class="stat-label">TOTAL SHOW</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">${setlists.length}</div>
          <div class="stat-label">JENIS SETLIST</div>
        </div>
      </div>
    </div>
    
    <div class="content">
      <div class="filter-section">
        <button class="filter-btn ${currentFilter === 'all' ? 'active' : ''}" onclick="filterShows('all')">
          Semua (${showsData.length})
        </button>
        ${setlists.map(setlist => {
          const count = showsData.filter(s => s.setlist_name === setlist).length;
          return `<button class="filter-btn ${currentFilter === setlist ? 'active' : ''}" onclick="filterShows('${setlist}')">${setlist} (${count})</button>`;
        }).join('')}
      </div>
      
      <div id="showListContainer">
        ${renderShowList()}
      </div>
    </div>
  `;
}

function renderShowList() {
  let filtered = showsData;
  
  if (currentFilter !== 'all') {
    filtered = showsData.filter(s => s.setlist_name === currentFilter);
  }
  
  const sortedFilteredShows = [...filtered].sort((a, b) => {
    const dateA = new Date(a.show_date + ' ' + a.show_time);
    const dateB = new Date(b.show_date + ' ' + b.show_time);
    return dateA - dateB;
  });
  
  const showsForDisplay = [...filtered].sort((a, b) => {
    const dateA = new Date(a.show_date + ' ' + a.show_time);
    const dateB = new Date(b.show_date + ' ' + b.show_time);
    return dateB - dateA;
  });
  
  if (filtered.length === 0) {
    return `
      <div class="empty-state">
        <div class="empty-icon">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
        </div>
        <div class="empty-title">Belum Ada Show</div>
        <div class="empty-desc">
          ${currentFilter === 'all' 
            ? 'Belum ada riwayat show yang tercatat untuk member ini' 
            : `Belum ada show dengan setlist "${currentFilter}"`
          }
        </div>
      </div>
    `;
  }
  
  return `
    <div class="show-list">
      ${showsForDisplay.map(show => {
        const date = show.show_date ? formatDate(show.show_date) : 'Tanggal tidak tersedia';
        const time = show.show_time ? formatTime(show.show_time) : null;
        const showNumber = sortedFilteredShows.findIndex(s => s.id === show.id) + 1;
        
        const status = getLiveStatus(show.show_date, show.show_time);
        const isLive = status === 'LIVE';
        
        const isMemberBirthday = show.is_birthday_show && show.birthday_member === memberData.name;
        const isMemberGraduation = show.is_graduation_show && show.graduation_member === memberData.name;
        
        let cardClass = 'show-card';
        if (isLive) cardClass += ' live-now';
        
        return `
          <div class="${cardClass}" onclick="openShowDetail('${show.setlist_name}', '${show.show_date}', '${show.show_time}')">
            <div class="show-header">
              <div>
                <div class="show-date">${date}</div>
                ${time ? `
                  <div class="show-time">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"></circle>
                      <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    ${time}
                  </div>
                ` : ''}
              </div>
              <div class="badge-container">
                ${isLive ? `
                  <div class="live-badge">
                    <span class="live-dot"></span>
                    LIVE
                  </div>
                ` : ''}
                ${isMemberBirthday ? `
                  <div class="sts-badge">
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16">
                      <path d="m7.994.013-.595.79a.747.747 0 0 0 .101 1.01V4H5a2 2 0 0 0-2 2v3H2a2 2 0 0 0-2 2v4a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-4a2 2 0 0 0-2-2h-1V6a2 2 0 0 0-2-2H8.5V1.806A.747.747 0 0 0 8.592.802zM4 6a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v.414a.9.9 0 0 1-.646-.268 1.914 1.914 0 0 0-2.708 0 .914.914 0 0 1-1.292 0 1.914 1.914 0 0 0-2.708 0A.9.9 0 0 1 4 6.414zm0 1.414c.49 0 .98-.187 1.354-.56a.914.914 0 0 1 1.292 0c.748.747 1.96.747 2.708 0a.914.914 0 0 1 1.292 0c.374.373.864.56 1.354.56V9H4zM1 11a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v.793l-.354.354a.914.914 0 0 1-1.293 0 1.914 1.914 0 0 0-2.707 0 .914.914 0 0 1-1.292 0 1.914 1.914 0 0 0-2.708 0 .914.914 0 0 1-1.292 0L1 11.793zm11.646 1.854a1.915 1.915 0 0 0 2.354.279V15H1v-1.867c.737.452 1.715.36 2.354-.28a.914.914 0 0 1 1.292 0c.748.748 1.96.748 2.708 0a.914.914 0 0 1 1.292 0c.748.748 1.96.748 2.707 0a.914.914 0 0 1 1.293 0Z"/>
                    </svg>
                    STS
                  </div>
                ` : ''}
                ${isMemberGraduation ? `
                  <div class="lastshow-badge">
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16">
                      <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zM4.5 6.5a.5.5 0 0 1 0-1h5.793L8.146 4.354a.5.5 0 1 1 .708-.708l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708L10.293 7.5H4.5z"/>
                    </svg>
                    Last Show
                  </div>
                ` : ''}
                <div class="show-badge">#${showNumber}</div>
              </div>
            </div>
            <div class="show-setlist">
              ${show.setlist_name}
              ${show.is_birthday_show && show.birthday_member ? ` (STS ${show.birthday_member})` : ''}
              ${show.is_graduation_show && show.graduation_member ? ` (Last Show ${show.graduation_member})` : ''}
            </div>
          </div>
        `;
      }).join('')}
    </div>
  `;
}

function filterShows(filter) {
  currentFilter = filter;
  
  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  event.target.classList.add('active');
  
  document.getElementById('showListContainer').innerHTML = renderShowList();
}

function formatDate(dateString) {
  const date = new Date(dateString);
  const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
  return date.toLocaleDateString('id-ID', options);
}

function formatTime(timeString) {
  if (!timeString) return null;
  
  const parts = timeString.split(':');
  const hours = parts[0];
  const minutes = parts[1];
  
  return `${hours}:${minutes} WIB`;
}

function adjustColor(color, amount) {
  const num = parseInt(color.replace('#', ''), 16);
  const r = Math.max(0, Math.min(255, (num >> 16) + amount));
  const g = Math.max(0, Math.min(255, ((num >> 8) & 0x00FF) + amount));
  const b = Math.max(0, Math.min(255, (num & 0x0000FF) + amount));
  return '#' + ((r << 16) | (g << 8) | b).toString(16).padStart(6, '0');
}

function goBack() {
  if (window.history.length > 1) {
    window.history.back();
  } else {
    window.location.href = 'index.html';
  }
}

function openShowDetail(setlistName, showDate, showTime) {
  const params = new URLSearchParams();
  params.append('setlist', setlistName);
  params.append('date', showDate);
  if (showTime) {
    params.append('time', showTime);
  }
  window.location.href = `liveshow.html?${params.toString()}`;
}

function showError(message) {
  document.getElementById('container').innerHTML = `
    <div class="content" style="padding:60px 20px;text-align:center">
      <div style="font-size:64px;margin-bottom:20px">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#e60012" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
      </div>
      <div style="font-size:18px;font-weight:bold;color:#333;margin-bottom:10px">${message}</div>
      <div style="color:#6b7280;margin-bottom:30px">Data tidak ditemukan atau terjadi kesalahan</div>
      <button onclick="goBack()" style="background:#e60012;color:#fff;border:none;border-radius:12px;padding:12px 24px;font-size:14px;font-weight:600;cursor:pointer">
        Kembali ke Beranda
      </button>
    </div>
  `;
}

window.addEventListener('DOMContentLoaded', () => {
  loadData();
});
</script>
</body>
</html>